{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Quick Start","text":"<p>Automated PPDG-3R (Capital Gains) and PP-OPO (Dividends / Interest) tax reports generation for Interactive Brokers in Serbia. The application automatically fetches transaction data and creates a ready-to-upload XML file, converting all prices to dinars (RSD).</p> <p>Install ibkr-porez \u2197</p> <p>Then you can use either the GUI (starts as <code>ibkr-porez</code> without arguments) or the command line interface, see below. The GUI and the CLI use the same database.</p> <p>\u26a0\ufe0f Do not use the command line while the GUI is running, as simultaneous usage may cause database errors.</p> <p>In the GUI, configure your data (the <code>Config</code> button), then use <code>Sync</code> to refresh data and create declarations.</p> <p>If you prefer doing everything through the command line, continue with:</p> <ul> <li>Configuration (config) \u2197</li> <li>Import Historical Data (import) \u2197</li> </ul> <p>\u26a0\ufe0f Import is only necessary if you have more than a year of transaction history in Interactive Brokers. Flex Query allows downloading data for no more than the last year, so older data must be loaded from a full export to CSV file \u2197.</p> Quickly create a specific declarationAutomatic declaration creation <p>If you want to quickly create a specific declaration.</p> <p>Fetch Latest Data (fetch) \u2197</p> <p>Generate Report (report) \u2197</p> <p>Upload the created XML to the ePorezi portal (PPDG-3R section).     </p> <p>If you want to automatically receive all necessary declarations and track their status (submitted, paid).</p> <p>Fetch Latest Data and Create Declarations (sync) \u2197</p> <p>Declaration Management \u2197</p>"},{"location":"ibkr/","title":"Interactive Brokers (IBKR)","text":""},{"location":"ibkr/#flex-web-service","title":"Flex Web Service","text":"<ol> <li>Performance &amp; Reports &gt; Flex Queries.</li> <li>Click the Settings icon (gear) in \"Flex Web Service Configuration\".</li> <li>Enable Flex Web Service.</li> <li>Generate Token.<ul> <li>Important: Copy this token immediately. You will not be able to see it fully again.</li> <li>Set expiration (recommended max - 1 year).</li> </ul> </li> </ol>"},{"location":"ibkr/#flex-query","title":"Flex Query","text":"<ol> <li>Performance &amp; Reports &gt; Flex Queries.</li> <li>Click + to create a new Activity Flex Query.</li> <li>Name: e.g., <code>ibkr-porez-data</code>.</li> <li>Delivery Configuration (at the bottom of the page):<ul> <li>Period: Select Last 365 Calendar Days.</li> </ul> </li> <li>Format: XML.</li> </ol>"},{"location":"ibkr/#sections-to-include","title":"Sections to Include:","text":"<p>Enable the following sections and check Select All for columns.</p> <p>If you don't trust anyone 8-) instead of Select All, select at least the fields listed in <code>Required Columns</code>.</p>"},{"location":"ibkr/#transactions","title":"Transactions","text":"<p>Located under Trade Confirmations or Activity.</p> Required Columns <ul> <li><code>Symbol</code></li> <li><code>Description</code></li> <li><code>Currency</code></li> <li><code>Quantity</code></li> <li><code>TradePrice</code></li> <li><code>TradeDate</code></li> <li><code>TradeID</code></li> <li><code>OrigTradeDate</code></li> <li><code>OrigTradePrice</code></li> <li><code>AssetClass</code></li> <li><code>Buy/Sell</code></li> </ul>"},{"location":"ibkr/#cash-transactions","title":"Cash Transactions","text":"Required Columns <ul> <li><code>Type</code></li> <li><code>Amount</code></li> <li><code>Currency</code></li> <li><code>DateTime</code> / <code>Date</code></li> <li><code>Symbol</code></li> <li><code>Description</code></li> <li><code>TransactionID</code></li> </ul>"},{"location":"ibkr/#save-and-get-query-id","title":"Save and Get Query ID","text":"<p>Note the Query ID (number usually appearing next to the query name in the list).</p> <p>You will need the Token and Query ID to configure <code>ibkr-porez</code>.</p>"},{"location":"ibkr/#confirmation-document","title":"Confirmation Document","text":"<p>For Item 8 (Dokazi uz prijavu) of the PPDG-3R tax return, you need a PDF report from the broker. It must be attached manually on the ePorezi portal after importing the XML.</p> <p>How to download the appropriate report:</p> <ol> <li>In IBKR go to Performance &amp; Reports &gt; Statements &gt; Activity Statement.</li> <li>Period: Select Custom Date Range.</li> <li>Specify dates corresponding to your tax period (e.g., <code>01-01-2024</code> to <code>30-06-2024</code> for the first half).</li> <li>Click Download PDF.</li> <li>On the ePorezi portal, in section 8. Dokazi uz prijavu, upload this file.</li> </ol>"},{"location":"ibkr/#export-full-history-for-import-command","title":"Export Full History (for import command)","text":"<p>If you need to load transaction history for a period longer than 1 year (unavailable via Flex Web Service), export data to CSV:</p> <ol> <li>In IBKR go to Performance &amp; Reports &gt; Statements &gt; Activity Statement.</li> <li>Period: Select Custom Date Range and specify the entire period since account opening.</li> <li>Click Download CSV.</li> <li>This file can be used with the import \u2197 command.</li> </ol>"},{"location":"installation/","title":"Installation","text":"<p>Recommended to use <code>pipx</code> for installation to prevent conflicts with system Python packages:</p>"},{"location":"installation/#install-pipx","title":"Install <code>pipx</code>","text":"MacOSLinuxWindows <pre><code>brew install pipx\npipx ensurepath\n</code></pre> <pre><code>python3 -m pip install --user pipx\npython3 -m pipx ensurepath\n</code></pre> <pre><code># If you installed python using the app-store, replace `python` with `python3` in the next line.\npython -m pip install --user pipx\n</code></pre>"},{"location":"installation/#install-application","title":"Install Application","text":"<pre><code>pipx install ibkr-porez\n</code></pre>"},{"location":"reference/","title":"Reference","text":""},{"location":"reference/#ibkr_porez","title":"ibkr_porez","text":"<p>Automated PPDG-3R tax reports for Interactive Brokers.</p> <p>It automatically pulls your data and generates a ready-to-upload XML file with all prices converted to RSD.</p> <p>The file is mandatory for build system to find the package.</p>"},{"location":"reference/#ibkr_porez-modules","title":"Modules","text":""},{"location":"reference/#ibkr_porez.config","title":"ibkr_porez.config","text":""},{"location":"reference/#ibkr_porez.config-attributes","title":"Attributes","text":""},{"location":"reference/#ibkr_porez.config.DATA_SUBDIR","title":"ibkr_porez.config.DATA_SUBDIR  <code>module-attribute</code>","text":"<pre><code>DATA_SUBDIR = 'ibkr-porez-data'\n</code></pre>"},{"location":"reference/#ibkr_porez.config.config_manager","title":"ibkr_porez.config.config_manager  <code>module-attribute</code>","text":"<pre><code>config_manager = ConfigManager()\n</code></pre>"},{"location":"reference/#ibkr_porez.config-classes","title":"Classes","text":""},{"location":"reference/#ibkr_porez.config.ConfigManager","title":"ibkr_porez.config.ConfigManager","text":"Attributes ibkr_porez.config.ConfigManager.APP_NAME <code>class-attribute</code> <code>instance-attribute</code> <pre><code>APP_NAME = 'ibkr-porez'\n</code></pre> <code></code> ibkr_porez.config.ConfigManager.CONFIG_FILENAME <code>class-attribute</code> <code>instance-attribute</code> <pre><code>CONFIG_FILENAME = 'config.json'\n</code></pre> <code></code> ibkr_porez.config.ConfigManager.config_path <code>property</code> <pre><code>config_path: Path\n</code></pre> Functions <code></code> ibkr_porez.config.ConfigManager.load_config <pre><code>load_config() -&gt; UserConfig\n</code></pre> <code></code> ibkr_porez.config.ConfigManager.save_config <pre><code>save_config(config: UserConfig)\n</code></pre>"},{"location":"reference/#ibkr_porez.config-functions","title":"Functions","text":""},{"location":"reference/#ibkr_porez.config.get_data_dir_change_warning","title":"ibkr_porez.config.get_data_dir_change_warning","text":"<pre><code>get_data_dir_change_warning(old_config: UserConfig, new_config: UserConfig) -&gt; str | None\n</code></pre> <p>Return warning message if effective data directory changed.</p>"},{"location":"reference/#ibkr_porez.config.get_default_data_dir_path","title":"ibkr_porez.config.get_default_data_dir_path","text":"<pre><code>get_default_data_dir_path() -&gt; Path\n</code></pre> <p>Return default data directory path.</p>"},{"location":"reference/#ibkr_porez.config.get_default_output_dir_path","title":"ibkr_porez.config.get_default_output_dir_path","text":"<pre><code>get_default_output_dir_path() -&gt; Path\n</code></pre> <p>Return default output directory path.</p>"},{"location":"reference/#ibkr_porez.config.get_effective_data_dir_path","title":"ibkr_porez.config.get_effective_data_dir_path","text":"<pre><code>get_effective_data_dir_path(config: UserConfig) -&gt; Path\n</code></pre> <p>Resolve data dir with fallback to default directory.</p>"},{"location":"reference/#ibkr_porez.config.get_effective_output_dir_path","title":"ibkr_porez.config.get_effective_output_dir_path","text":"<pre><code>get_effective_output_dir_path(config: UserConfig | None = None) -&gt; Path\n</code></pre> <p>Resolve output directory with fallback to default directory.</p>"},{"location":"reference/#ibkr_porez.declaration_gains_xml","title":"ibkr_porez.declaration_gains_xml","text":""},{"location":"reference/#ibkr_porez.declaration_gains_xml-classes","title":"Classes","text":""},{"location":"reference/#ibkr_porez.declaration_gains_xml.XMLGenerator","title":"ibkr_porez.declaration_gains_xml.XMLGenerator","text":"<p>Generator for PPDG-3R XML declarations.</p> Attributes ibkr_porez.declaration_gains_xml.XMLGenerator.TAX_DUE_DATE_DAYS <code>class-attribute</code> <code>instance-attribute</code> <pre><code>TAX_DUE_DATE_DAYS = 30\n</code></pre> <code></code> ibkr_porez.declaration_gains_xml.XMLGenerator.config <code>instance-attribute</code> <pre><code>config = config\n</code></pre> Functions <code></code> ibkr_porez.declaration_gains_xml.XMLGenerator.generate_xml <pre><code>generate_xml(entries: list[TaxReportEntry], _period_start: date, period_end: date) -&gt; str\n</code></pre> <p>Generate PPDG-3R XML content.</p>"},{"location":"reference/#ibkr_porez.declaration_income_xml","title":"ibkr_porez.declaration_income_xml","text":"<p>Generator for PP OPO (Capital Income) XML declarations.</p>"},{"location":"reference/#ibkr_porez.declaration_income_xml-attributes","title":"Attributes","text":""},{"location":"reference/#ibkr_porez.declaration_income_xml-classes","title":"Classes","text":""},{"location":"reference/#ibkr_porez.declaration_income_xml.IncomeXMLGenerator","title":"ibkr_porez.declaration_income_xml.IncomeXMLGenerator","text":"<p>Generator for PP OPO XML declarations.</p> Attributes ibkr_porez.declaration_income_xml.IncomeXMLGenerator.TAX_DUE_DATE_DAYS <code>class-attribute</code> <code>instance-attribute</code> <pre><code>TAX_DUE_DATE_DAYS = 30\n</code></pre> <code></code> ibkr_porez.declaration_income_xml.IncomeXMLGenerator.config <code>instance-attribute</code> <pre><code>config = config\n</code></pre> Functions <code></code> ibkr_porez.declaration_income_xml.IncomeXMLGenerator.generate_xml <pre><code>generate_xml(income_entries: list[IncomeEntry], declaration_date: date, income_type: str, withholding_tax_rsd: Decimal = Decimal('0.00')) -&gt; str\n</code></pre> <p>Generate PP OPO XML for given income entries.</p> <p>Parameters:</p> Name Type Description Default <code>income_entries</code> <code>list[IncomeEntry]</code> <p>List of income entries (all should be same date and type).</p> required <code>declaration_date</code> <code>date</code> <p>Date of income realization (YYYY-MM-DD).</p> required <code>income_type</code> <code>str</code> <p>Type of income (\"dividend\" or \"coupon\").</p> required <p>Returns:</p> Name Type Description <code>str</code> <code>str</code> <p>XML content for PP OPO declaration.</p>"},{"location":"reference/#ibkr_porez.declaration_manager","title":"ibkr_porez.declaration_manager","text":"<p>Declaration management operations.</p>"},{"location":"reference/#ibkr_porez.declaration_manager-classes","title":"Classes","text":""},{"location":"reference/#ibkr_porez.declaration_manager.DeclarationManager","title":"ibkr_porez.declaration_manager.DeclarationManager","text":"<p>Manager for declaration status operations.</p> Attributes ibkr_porez.declaration_manager.DeclarationManager.storage <code>instance-attribute</code> <pre><code>storage = Storage()\n</code></pre> Functions <code></code> ibkr_porez.declaration_manager.DeclarationManager.apply_status <pre><code>apply_status(declaration_ids: list[str], target_status: DeclarationStatus) -&gt; list[str]\n</code></pre> <p>Apply target status using the canonical status-operation mapping.</p> <code></code> ibkr_porez.declaration_manager.DeclarationManager.assessment_message <code>staticmethod</code> <pre><code>assessment_message(declaration_id, tax_due_rsd, status, mark_paid)\n</code></pre> <code></code> ibkr_porez.declaration_manager.DeclarationManager.attach_file <pre><code>attach_file(declaration_id: str, file_path: Path) -&gt; str\n</code></pre> <p>Attach file to declaration.</p> <p>Parameters:</p> Name Type Description Default <code>declaration_id</code> <code>str</code> <p>Declaration ID</p> required <code>file_path</code> <code>Path</code> <p>Path to file to attach</p> required <p>Returns:</p> Name Type Description <code>str</code> <code>str</code> <p>File identifier (filename) used as unique ID within declaration</p> <code></code> ibkr_porez.declaration_manager.DeclarationManager.detach_file <pre><code>detach_file(declaration_id: str, file_identifier: str) -&gt; None\n</code></pre> <p>Remove attached file from declaration.</p> <p>Parameters:</p> Name Type Description Default <code>declaration_id</code> <code>str</code> <p>Declaration ID</p> required <code>file_identifier</code> <code>str</code> <p>File identifier (filename) to remove</p> required <code></code> ibkr_porez.declaration_manager.DeclarationManager.export <pre><code>export(declaration_id: str, output_dir: Path | None = None) -&gt; tuple[Path, list[Path]]\n</code></pre> <p>Export declaration XML and all attached files.</p> <p>Parameters:</p> Name Type Description Default <code>declaration_id</code> <code>str</code> <p>Declaration ID</p> required <code>output_dir</code> <code>Path | None</code> <p>Output directory (default: from config or Downloads)</p> <code>None</code> <p>Returns:</p> Type Description <code>tuple[Path, list[Path]]</code> <p>tuple[Path, list[Path]]: (xml_file_path, list of attached file paths)</p> <code></code> ibkr_porez.declaration_manager.DeclarationManager.has_tax_to_pay <code>classmethod</code> <pre><code>has_tax_to_pay(declaration: Declaration) -&gt; bool\n</code></pre> <p>Return whether declaration has positive tax due.</p> <code></code> ibkr_porez.declaration_manager.DeclarationManager.is_transition_allowed <code>staticmethod</code> <pre><code>is_transition_allowed(current_status: DeclarationStatus, target_status: DeclarationStatus) -&gt; bool\n</code></pre> <p>Return whether status transition is allowed.</p> <code></code> ibkr_porez.declaration_manager.DeclarationManager.pay <pre><code>pay(declaration_ids: list[str]) -&gt; list[str]\n</code></pre> <p>Mark declaration(s) as finalized.</p> <p>Parameters:</p> Name Type Description Default <code>declaration_ids</code> <code>list[str]</code> <p>List of declaration IDs to pay</p> required <p>Returns:</p> Type Description <code>list[str]</code> <p>list[str]: List of declaration IDs that were marked finalized</p> <code></code> ibkr_porez.declaration_manager.DeclarationManager.revert <pre><code>revert(declaration_ids: list[str], target_status: DeclarationStatus) -&gt; None\n</code></pre> <p>Revert declaration status (e.g., finalized -&gt; draft).</p> <p>Parameters:</p> Name Type Description Default <code>declaration_ids</code> <code>list[str]</code> <p>List of declaration IDs to revert</p> required <code>target_status</code> <code>DeclarationStatus</code> <p>Target status (usually DRAFT)</p> required <code></code> ibkr_porez.declaration_manager.DeclarationManager.set_assessed_tax <pre><code>set_assessed_tax(declaration_id: str, tax_due_rsd: Decimal, mark_paid: bool = False) -&gt; Declaration\n</code></pre> <p>Set official assessed tax amount and update declaration status.</p> <code></code> ibkr_porez.declaration_manager.DeclarationManager.submit <pre><code>submit(declaration_ids: list[str]) -&gt; list[str]\n</code></pre> <p>Mark declaration(s) as submitted.</p> <p>Parameters:</p> Name Type Description Default <code>declaration_ids</code> <code>list[str]</code> <p>List of declaration IDs to submit</p> required <p>Returns:</p> Type Description <code>list[str]</code> <p>list[str]: List of declaration IDs that were submitted</p> <code></code> ibkr_porez.declaration_manager.DeclarationManager.tax_due_rsd <code>staticmethod</code> <pre><code>tax_due_rsd(declaration: Declaration) -&gt; Decimal\n</code></pre> <p>Return tax due from declaration metadata.</p> <p>Missing/invalid metadata is treated as non-zero to avoid accidental auto-finalization.</p>"},{"location":"reference/#ibkr_porez.declaration_manager-functions","title":"Functions","text":""},{"location":"reference/#ibkr_porez.error_handling","title":"ibkr_porez.error_handling","text":"<p>Error handling utilities for user-friendly error messages.</p>"},{"location":"reference/#ibkr_porez.error_handling-functions","title":"Functions","text":""},{"location":"reference/#ibkr_porez.error_handling.get_user_friendly_error_message","title":"ibkr_porez.error_handling.get_user_friendly_error_message","text":"<pre><code>get_user_friendly_error_message(exception: Exception) -&gt; str\n</code></pre> <p>Extract user-friendly error message from exception chain.</p> <p>Traverses the exception chain to find the most meaningful error message for the user, avoiding wrapper exceptions like RetryError.</p> <p>Parameters:</p> Name Type Description Default <code>exception</code> <code>Exception</code> <p>The exception to extract message from</p> required <p>Returns:</p> Type Description <code>str</code> <p>User-friendly error message string</p>"},{"location":"reference/#ibkr_porez.gui","title":"ibkr_porez.gui","text":"<p>GUI package for ibkr-porez.</p>"},{"location":"reference/#ibkr_porez.gui-modules","title":"Modules","text":""},{"location":"reference/#ibkr_porez.gui.app_icon","title":"ibkr_porez.gui.app_icon","text":"Functions ibkr_porez.gui.app_icon.create_app_icon <pre><code>create_app_icon() -&gt; QIcon\n</code></pre>"},{"location":"reference/#ibkr_porez.gui.assessment_dialog","title":"ibkr_porez.gui.assessment_dialog","text":"Classes ibkr_porez.gui.assessment_dialog.AssessmentDialog <p>               Bases: <code>QDialog</code></p> Attributes <code></code> ibkr_porez.gui.assessment_dialog.AssessmentDialog.button_box <code>instance-attribute</code> <pre><code>button_box = QDialogButtonBox(Cancel | Ok)\n</code></pre> <code></code> ibkr_porez.gui.assessment_dialog.AssessmentDialog.help_label <code>instance-attribute</code> <pre><code>help_label = QLabel(f'Declaration: {declaration_id}. Enter official tax due from tax authority notice.')\n</code></pre> <code></code> ibkr_porez.gui.assessment_dialog.AssessmentDialog.mark_paid <code>instance-attribute</code> <pre><code>mark_paid: bool = False\n</code></pre> <code></code> ibkr_porez.gui.assessment_dialog.AssessmentDialog.mark_paid_checkbox <code>instance-attribute</code> <pre><code>mark_paid_checkbox = QCheckBox('Already paid')\n</code></pre> <code></code> ibkr_porez.gui.assessment_dialog.AssessmentDialog.tax_due_input <code>instance-attribute</code> <pre><code>tax_due_input = QLineEdit()\n</code></pre> <code></code> ibkr_porez.gui.assessment_dialog.AssessmentDialog.tax_due_rsd <code>instance-attribute</code> <pre><code>tax_due_rsd: Decimal | None = None\n</code></pre> Functions <code></code> ibkr_porez.gui.assessment_dialog.AssessmentDialog.accept <pre><code>accept() -&gt; None\n</code></pre>"},{"location":"reference/#ibkr_porez.gui.config_dialog","title":"ibkr_porez.gui.config_dialog","text":"Attributes ibkr_porez.gui.config_dialog.FLEX_DOCS_URL <code>module-attribute</code> <pre><code>FLEX_DOCS_URL = 'https://andgineer.github.io/ibkr-porez/ibkr/#flex-web-service'\n</code></pre> Classes <code></code> ibkr_porez.gui.config_dialog.ConfigDialog <p>               Bases: <code>QDialog</code></p> Attributes <code></code> ibkr_porez.gui.config_dialog.ConfigDialog.address <code>instance-attribute</code> <pre><code>address = QLineEdit(address)\n</code></pre> <code></code> ibkr_porez.gui.config_dialog.ConfigDialog.app_files_dir <code>instance-attribute</code> <pre><code>app_files_dir = parent\n</code></pre> <code></code> ibkr_porez.gui.config_dialog.ConfigDialog.app_files_info <code>instance-attribute</code> <pre><code>app_files_info = QLabel(str(app_files_dir))\n</code></pre> <code></code> ibkr_porez.gui.config_dialog.ConfigDialog.city_code <code>instance-attribute</code> <pre><code>city_code = QLineEdit(city_code)\n</code></pre> <code></code> ibkr_porez.gui.config_dialog.ConfigDialog.data_dir <code>instance-attribute</code> <pre><code>data_dir = QLineEdit(data_dir or '')\n</code></pre> <code></code> ibkr_porez.gui.config_dialog.ConfigDialog.email <code>instance-attribute</code> <pre><code>email = QLineEdit(email)\n</code></pre> <code></code> ibkr_porez.gui.config_dialog.ConfigDialog.full_name <code>instance-attribute</code> <pre><code>full_name = QLineEdit(full_name)\n</code></pre> <code></code> ibkr_porez.gui.config_dialog.ConfigDialog.ibkr_query_id <code>instance-attribute</code> <pre><code>ibkr_query_id = QLineEdit(ibkr_query_id)\n</code></pre> <code></code> ibkr_porez.gui.config_dialog.ConfigDialog.ibkr_token <code>instance-attribute</code> <pre><code>ibkr_token = QLineEdit(ibkr_token)\n</code></pre> <code></code> ibkr_porez.gui.config_dialog.ConfigDialog.output_folder <code>instance-attribute</code> <pre><code>output_folder = QLineEdit(output_folder or '')\n</code></pre> <code></code> ibkr_porez.gui.config_dialog.ConfigDialog.personal_id <code>instance-attribute</code> <pre><code>personal_id = QLineEdit(personal_id)\n</code></pre> <code></code> ibkr_porez.gui.config_dialog.ConfigDialog.phone <code>instance-attribute</code> <pre><code>phone = QLineEdit(phone)\n</code></pre> Functions <code></code> ibkr_porez.gui.config_dialog.ConfigDialog.get_config <pre><code>get_config() -&gt; UserConfig\n</code></pre> Functions"},{"location":"reference/#ibkr_porez.gui.constants","title":"ibkr_porez.gui.constants","text":"Attributes ibkr_porez.gui.constants.BULK_STATUS_OPTIONS <code>module-attribute</code> <pre><code>BULK_STATUS_OPTIONS = ('Submit', 'Pay')\n</code></pre> <code></code> ibkr_porez.gui.constants.FILTER_ORDER <code>module-attribute</code> <pre><code>FILTER_ORDER = ('Active', 'All', 'Pending payment')\n</code></pre> <code></code> ibkr_porez.gui.constants.INVALID_IDS_PREVIEW_COUNT <code>module-attribute</code> <pre><code>INVALID_IDS_PREVIEW_COUNT = 3\n</code></pre> <code></code> ibkr_porez.gui.constants.PROGRESS_MAX <code>module-attribute</code> <pre><code>PROGRESS_MAX = 100\n</code></pre> <code></code> ibkr_porez.gui.constants.ROW_STATUS_ACTIONS <code>module-attribute</code> <pre><code>ROW_STATUS_ACTIONS = (('Submit', 'Submitted'), ('Pay', 'Finalized'), ('Revert', 'Draft'))\n</code></pre>"},{"location":"reference/#ibkr_porez.gui.declaration_details_dialog","title":"ibkr_porez.gui.declaration_details_dialog","text":"Classes ibkr_porez.gui.declaration_details_dialog.DeclarationDetailsDialog <p>               Bases: <code>QDialog</code></p> Attributes <code></code> ibkr_porez.gui.declaration_details_dialog.DeclarationDetailsDialog.details_view <code>instance-attribute</code> <pre><code>details_view = QPlainTextEdit()\n</code></pre> Functions"},{"location":"reference/#ibkr_porez.gui.export_worker","title":"ibkr_porez.gui.export_worker","text":"Classes ibkr_porez.gui.export_worker.ExportWorker <p>               Bases: <code>QObject</code></p> Attributes <code></code> ibkr_porez.gui.export_worker.ExportWorker.declaration_id <code>instance-attribute</code> <pre><code>declaration_id = declaration_id\n</code></pre> <code></code> ibkr_porez.gui.export_worker.ExportWorker.declaration_manager <code>instance-attribute</code> <pre><code>declaration_manager = DeclarationManager()\n</code></pre> <code></code> ibkr_porez.gui.export_worker.ExportWorker.failed <code>class-attribute</code> <code>instance-attribute</code> <pre><code>failed = Signal(str)\n</code></pre> <code></code> ibkr_porez.gui.export_worker.ExportWorker.finished <code>class-attribute</code> <code>instance-attribute</code> <pre><code>finished = Signal(str)\n</code></pre> Functions <code></code> ibkr_porez.gui.export_worker.ExportWorker.run <pre><code>run() -&gt; None\n</code></pre> Functions"},{"location":"reference/#ibkr_porez.gui.import_dialog","title":"ibkr_porez.gui.import_dialog","text":"Attributes ibkr_porez.gui.import_dialog.IMPORT_DOCS_URL <code>module-attribute</code> <pre><code>IMPORT_DOCS_URL = 'https://andgineer.github.io/ibkr-porez/ibkr/#export-full-history-for-import-command'\n</code></pre> <code></code> ibkr_porez.gui.import_dialog.IMPORT_GUIDANCE_TEXT <code>module-attribute</code> <pre><code>IMPORT_GUIDANCE_TEXT = 'Import is needed for transactions older than one year to calculate stock sale income correctly. Data within the last year is fetched by Sync.'\n</code></pre> Classes <code></code> ibkr_porez.gui.import_dialog.ImportDialog <p>               Bases: <code>QDialog</code></p> Attributes <code></code> ibkr_porez.gui.import_dialog.ImportDialog.import_thread <code>instance-attribute</code> <pre><code>import_thread: QThread | None = None\n</code></pre> <code></code> ibkr_porez.gui.import_dialog.ImportDialog.import_worker <code>instance-attribute</code> <pre><code>import_worker: ImportWorker | None = None\n</code></pre> Functions <code></code> ibkr_porez.gui.import_dialog.ImportDialog.closeEvent <pre><code>closeEvent(event: QCloseEvent) -&gt; None\n</code></pre> <code></code> ibkr_porez.gui.import_dialog.ImportDialog.on_import_failed <pre><code>on_import_failed(message: str) -&gt; None\n</code></pre> <code></code> ibkr_porez.gui.import_dialog.ImportDialog.on_import_finished <pre><code>on_import_finished(total: int, inserted: int, updated: int) -&gt; None\n</code></pre> <code></code> ibkr_porez.gui.import_dialog.ImportDialog.on_import_thread_finished <pre><code>on_import_thread_finished() -&gt; None\n</code></pre> <code></code> ibkr_porez.gui.import_dialog.ImportDialog.reject <pre><code>reject() -&gt; None\n</code></pre> <code></code> ibkr_porez.gui.import_dialog.ImportDialog.start_import <pre><code>start_import() -&gt; None\n</code></pre>"},{"location":"reference/#ibkr_porez.gui.import_worker","title":"ibkr_porez.gui.import_worker","text":"Classes ibkr_porez.gui.import_worker.ImportWorker <p>               Bases: <code>QObject</code></p> Attributes <code></code> ibkr_porez.gui.import_worker.ImportWorker.failed <code>class-attribute</code> <code>instance-attribute</code> <pre><code>failed = Signal(str)\n</code></pre> <code></code> ibkr_porez.gui.import_worker.ImportWorker.file_path <code>instance-attribute</code> <pre><code>file_path = file_path\n</code></pre> <code></code> ibkr_porez.gui.import_worker.ImportWorker.finished <code>class-attribute</code> <code>instance-attribute</code> <pre><code>finished = Signal(int, int, int)\n</code></pre> <code></code> ibkr_porez.gui.import_worker.ImportWorker.import_type <code>instance-attribute</code> <pre><code>import_type = import_type\n</code></pre> Functions <code></code> ibkr_porez.gui.import_worker.ImportWorker.run <pre><code>run() -&gt; None\n</code></pre> Functions"},{"location":"reference/#ibkr_porez.gui.launcher","title":"ibkr_porez.gui.launcher","text":"<p>GUI process launcher helpers.</p> Functions ibkr_porez.gui.launcher.launch_gui_process <pre><code>launch_gui_process(console: Console, app_version: str) -&gt; None\n</code></pre> <p>Launch GUI in a detached process and return immediately.</p> <code></code> ibkr_porez.gui.launcher.prepare_gui_process_identity <pre><code>prepare_gui_process_identity() -&gt; None\n</code></pre> <p>Apply platform-specific process identity settings for GUI process.</p>"},{"location":"reference/#ibkr_porez.gui.main","title":"ibkr_porez.gui.main","text":"Classes Functions ibkr_porez.gui.main.main <pre><code>main() -&gt; int\n</code></pre> <code></code> ibkr_porez.gui.main.run <pre><code>run() -&gt; int\n</code></pre>"},{"location":"reference/#ibkr_porez.gui.main_window","title":"ibkr_porez.gui.main_window","text":"Attributes ibkr_porez.gui.main_window.EMPTY_TRANSACTIONS_WARNING <code>module-attribute</code> <pre><code>EMPTY_TRANSACTIONS_WARNING = 'Transaction history is empty. If your trading history is over one year, import it via Import. This is important for correct stock sale tax calculation.'\n</code></pre> Classes <code></code> ibkr_porez.gui.main_window.MainWindow <p>               Bases: <code>QMainWindow</code></p> Attributes <code></code> ibkr_porez.gui.main_window.MainWindow.actions_column <code>instance-attribute</code> <pre><code>actions_column = index('Actions')\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.apply_status_button <code>instance-attribute</code> <pre><code>apply_status_button = QPushButton('Apply to selected')\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.bulk_status_combo <code>instance-attribute</code> <pre><code>bulk_status_combo = QComboBox()\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.clear_selection_button <code>instance-attribute</code> <pre><code>clear_selection_button = QPushButton('Unselect all')\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.config <code>instance-attribute</code> <pre><code>config = load_config()\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.config_button <code>instance-attribute</code> <pre><code>config_button = QPushButton('Config')\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.declaration_manager <code>instance-attribute</code> <pre><code>declaration_manager = DeclarationManager()\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.declarations <code>instance-attribute</code> <pre><code>declarations: list[Declaration] = []\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.details_hint_label <code>instance-attribute</code> <pre><code>details_hint_label = QLabel('Tip: double-click a row or press Enter to open details.')\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.export_active_button <code>instance-attribute</code> <pre><code>export_active_button: QToolButton | None = None\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.export_prev_progress <code>instance-attribute</code> <pre><code>export_prev_progress: tuple[int, int, int] | None = None\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.export_thread <code>instance-attribute</code> <pre><code>export_thread: QThread | None = None\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.export_worker <code>instance-attribute</code> <pre><code>export_worker: ExportWorker | None = None\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.filter_combo <code>instance-attribute</code> <pre><code>filter_combo = QComboBox()\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.force_sync_action <code>instance-attribute</code> <pre><code>force_sync_action = QAction('Force sync', sync_menu)\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.import_button <code>instance-attribute</code> <pre><code>import_button = QPushButton('Import')\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.open_details_shortcuts <code>instance-attribute</code> <pre><code>open_details_shortcuts: list[QShortcut] = []\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.progress_bar <code>instance-attribute</code> <pre><code>progress_bar = QProgressBar()\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.progress_label <code>instance-attribute</code> <pre><code>progress_label = QLabel('')\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.select_all_button <code>instance-attribute</code> <pre><code>select_all_button = QPushButton('Select all')\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.selection_info_label <code>instance-attribute</code> <pre><code>selection_info_label = QLabel('0 selected')\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.status_filter <code>instance-attribute</code> <pre><code>status_filter = 'Active'\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.storage <code>instance-attribute</code> <pre><code>storage = Storage()\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.sync_button <code>instance-attribute</code> <pre><code>sync_button = QToolButton()\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.sync_menu <code>instance-attribute</code> <pre><code>sync_menu = QMenu(sync_button)\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.sync_thread <code>instance-attribute</code> <pre><code>sync_thread: QThread | None = None\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.sync_worker <code>instance-attribute</code> <pre><code>sync_worker: SyncWorker | None = None\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.table <code>instance-attribute</code> <pre><code>table = QTableWidget(0, len(table_headers))\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.visible_indices <code>instance-attribute</code> <pre><code>visible_indices: list[int] = []\n</code></pre> Functions <code></code> ibkr_porez.gui.main_window.MainWindow.apply_selected_status_from_combo <pre><code>apply_selected_status_from_combo() -&gt; None\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.apply_status_to_ids <pre><code>apply_status_to_ids(declaration_ids: list[str], status: str) -&gt; None\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.apply_status_to_selected <pre><code>apply_status_to_selected(status: str) -&gt; None\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.build_row_actions <pre><code>build_row_actions(source_row: int) -&gt; QWidget\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.clear_selection <pre><code>clear_selection() -&gt; None\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.on_export_failed <pre><code>on_export_failed(message: str) -&gt; None\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.on_export_finished <pre><code>on_export_finished(export_dir: str) -&gt; None\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.on_export_thread_finished <pre><code>on_export_thread_finished() -&gt; None\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.on_sync_failed <pre><code>on_sync_failed(message: str) -&gt; None\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.on_sync_finished <pre><code>on_sync_finished(created_count: int, output_folder: str) -&gt; None\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.on_sync_thread_finished <pre><code>on_sync_thread_finished() -&gt; None\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.open_assessment_dialog <pre><code>open_assessment_dialog(source_row: int) -&gt; None\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.open_config <pre><code>open_config() -&gt; None\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.open_declaration_details_by_view_row <pre><code>open_declaration_details_by_view_row(view_row: int) -&gt; None\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.open_declaration_details_for_item <pre><code>open_declaration_details_for_item(item: QTableWidgetItem) -&gt; None\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.open_declaration_details_for_selected_row <pre><code>open_declaration_details_for_selected_row() -&gt; None\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.open_import <pre><code>open_import() -&gt; None\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.populate_table <pre><code>populate_table(reselect_declaration_ids: list[str] | None = None) -&gt; None\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.re_export_declaration <pre><code>re_export_declaration(source_row: int, button: QToolButton | None = None) -&gt; None\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.reload_declarations <pre><code>reload_declarations() -&gt; None\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.select_all_rows <pre><code>select_all_rows() -&gt; None\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.select_declaration_row <pre><code>select_declaration_row(declaration_id: str) -&gt; None\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.select_source_row <pre><code>select_source_row(source_row: int) -&gt; None\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.selected_declaration_ids <pre><code>selected_declaration_ids() -&gt; list[str]\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.selected_source_rows <pre><code>selected_source_rows() -&gt; list[int]\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.set_row_status <pre><code>set_row_status(source_row: int, status: str) -&gt; None\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.set_status_filter <pre><code>set_status_filter(filter_name: str) -&gt; None\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.start_forced_sync <pre><code>start_forced_sync() -&gt; None\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.start_sync <pre><code>start_sync() -&gt; None\n</code></pre> <code></code> ibkr_porez.gui.main_window.MainWindow.update_selection_info <pre><code>update_selection_info() -&gt; None\n</code></pre> Functions"},{"location":"reference/#ibkr_porez.gui.styles","title":"ibkr_porez.gui.styles","text":"Attributes ibkr_porez.gui.styles.APP_STYLESHEET <code>module-attribute</code> <pre><code>APP_STYLESHEET = '\\nQPushButton#syncButton,\\nQToolButton#syncButton {\\n    font-weight: 700;\\n    min-height: 40px;\\n}\\nQLabel#progressLabel {\\n    font-weight: 600;\\n}\\n'\n</code></pre>"},{"location":"reference/#ibkr_porez.gui.sync_worker","title":"ibkr_porez.gui.sync_worker","text":"Attributes Classes ibkr_porez.gui.sync_worker.SyncWorker <p>               Bases: <code>QObject</code></p> Attributes <code></code> ibkr_porez.gui.sync_worker.SyncWorker.failed <code>class-attribute</code> <code>instance-attribute</code> <pre><code>failed = Signal(str)\n</code></pre> <code></code> ibkr_porez.gui.sync_worker.SyncWorker.finished <code>class-attribute</code> <code>instance-attribute</code> <pre><code>finished = Signal(int, str)\n</code></pre> <code></code> ibkr_porez.gui.sync_worker.SyncWorker.forced <code>instance-attribute</code> <pre><code>forced = forced\n</code></pre> Functions <code></code> ibkr_porez.gui.sync_worker.SyncWorker.run <pre><code>run() -&gt; None\n</code></pre> Functions"},{"location":"reference/#ibkr_porez.ibkr_csv","title":"ibkr_porez.ibkr_csv","text":""},{"location":"reference/#ibkr_porez.ibkr_csv-classes","title":"Classes","text":""},{"location":"reference/#ibkr_porez.ibkr_csv.CSVParser","title":"ibkr_porez.ibkr_csv.CSVParser","text":"<p>Parses IBKR Activity Statement CSV files.</p> Functions ibkr_porez.ibkr_csv.CSVParser.parse <pre><code>parse(file_content: TextIO) -&gt; list[Transaction]\n</code></pre> <p>Parse CSV content and return a list of Transactions. Expects standard IBKR Activity Statement CSV export.</p>"},{"location":"reference/#ibkr_porez.ibkr_flex_query","title":"ibkr_porez.ibkr_flex_query","text":""},{"location":"reference/#ibkr_porez.ibkr_flex_query-attributes","title":"Attributes","text":""},{"location":"reference/#ibkr_porez.ibkr_flex_query.logger","title":"ibkr_porez.ibkr_flex_query.logger  <code>module-attribute</code>","text":"<pre><code>logger = getLogger(__name__)\n</code></pre>"},{"location":"reference/#ibkr_porez.ibkr_flex_query-classes","title":"Classes","text":""},{"location":"reference/#ibkr_porez.ibkr_flex_query.IBKRClient","title":"ibkr_porez.ibkr_flex_query.IBKRClient","text":"Attributes ibkr_porez.ibkr_flex_query.IBKRClient.FLEX_URL_GET <code>class-attribute</code> <code>instance-attribute</code> <pre><code>FLEX_URL_GET = 'https://ndcdyn.interactivebrokers.com/Universal/servlet/FlexStatementService.GetStatement'\n</code></pre> <code></code> ibkr_porez.ibkr_flex_query.IBKRClient.FLEX_URL_REQUEST <code>class-attribute</code> <code>instance-attribute</code> <pre><code>FLEX_URL_REQUEST = 'https://ndcdyn.interactivebrokers.com/Universal/servlet/FlexStatementService.SendRequest'\n</code></pre> <code></code> ibkr_porez.ibkr_flex_query.IBKRClient.VERSION <code>class-attribute</code> <code>instance-attribute</code> <pre><code>VERSION = '3'\n</code></pre> <code></code> ibkr_porez.ibkr_flex_query.IBKRClient.query_id <code>instance-attribute</code> <pre><code>query_id = query_id\n</code></pre> <code></code> ibkr_porez.ibkr_flex_query.IBKRClient.token <code>instance-attribute</code> <pre><code>token = token\n</code></pre> Functions <code></code> ibkr_porez.ibkr_flex_query.IBKRClient.fetch_latest_report <pre><code>fetch_latest_report() -&gt; bytes\n</code></pre> <p>Fetch the latest Flex Query.</p> <code></code> ibkr_porez.ibkr_flex_query.IBKRClient.parse_report <pre><code>parse_report(xml_content: bytes) -&gt; list[Transaction]\n</code></pre> <p>Parse XML content and extract transactions manually.</p>"},{"location":"reference/#ibkr_porez.logging_config","title":"ibkr_porez.logging_config","text":"<p>Logging configuration for ibkr-porez.</p>"},{"location":"reference/#ibkr_porez.logging_config-attributes","title":"Attributes","text":""},{"location":"reference/#ibkr_porez.logging_config.ERROR_LOG_FILE","title":"ibkr_porez.logging_config.ERROR_LOG_FILE  <code>module-attribute</code>","text":"<pre><code>ERROR_LOG_FILE = LOG_DIR / 'error.log'\n</code></pre>"},{"location":"reference/#ibkr_porez.logging_config.LOG_DIR","title":"ibkr_porez.logging_config.LOG_DIR  <code>module-attribute</code>","text":"<pre><code>LOG_DIR = Path(user_data_dir('ibkr-porez')) / 'logs'\n</code></pre>"},{"location":"reference/#ibkr_porez.logging_config-functions","title":"Functions","text":""},{"location":"reference/#ibkr_porez.logging_config.setup_logger","title":"ibkr_porez.logging_config.setup_logger","text":"<pre><code>setup_logger() -&gt; Logger\n</code></pre> <p>Setup file logger for error logging with rotation.</p> <p>Uses TimedRotatingFileHandler with daily rotation. Keeps last 90 days (approximately 3 months) of logs. Standard Python logging mechanism automatically deletes old files.</p> <p>Returns:</p> Type Description <code>Logger</code> <p>Configured logger instance</p>"},{"location":"reference/#ibkr_porez.main","title":"ibkr_porez.main","text":"<p>ibkr-porez.</p>"},{"location":"reference/#ibkr_porez.main-attributes","title":"Attributes","text":""},{"location":"reference/#ibkr_porez.main.OUTPUT_FILE_DEFAULT","title":"ibkr_porez.main.OUTPUT_FILE_DEFAULT  <code>module-attribute</code>","text":"<pre><code>OUTPUT_FILE_DEFAULT = 'output'\n</code></pre>"},{"location":"reference/#ibkr_porez.main.console","title":"ibkr_porez.main.console  <code>module-attribute</code>","text":"<pre><code>console = Console()\n</code></pre>"},{"location":"reference/#ibkr_porez.main.logger","title":"ibkr_porez.main.logger  <code>module-attribute</code>","text":"<pre><code>logger = setup_logger()\n</code></pre>"},{"location":"reference/#ibkr_porez.main-classes","title":"Classes","text":""},{"location":"reference/#ibkr_porez.main-functions","title":"Functions","text":""},{"location":"reference/#ibkr_porez.main.assess","title":"ibkr_porez.main.assess","text":"<pre><code>assess(declaration_id: str, tax_due_str: str, mark_paid: bool)\n</code></pre> <p>Set official assessed tax amount for a declaration.</p>"},{"location":"reference/#ibkr_porez.main.attach","title":"ibkr_porez.main.attach","text":"<pre><code>attach(declaration_id: str, file_path: str | None, delete: bool, file_id: str | None)\n</code></pre> <p>Attach or remove file from declaration.</p> <p>To attach: ibkr-porez attach   To remove: ibkr-porez attach   --delete"},{"location":"reference/#ibkr_porez.main.config","title":"ibkr_porez.main.config","text":"<pre><code>config()\n</code></pre> <p>Configure IBKR and personal details.</p>"},{"location":"reference/#ibkr_porez.main.export","title":"ibkr_porez.main.export","text":"<pre><code>export(declaration_id: str, output: str | None)\n</code></pre> <p>Export declaration XML and all attached files.</p>"},{"location":"reference/#ibkr_porez.main.export_flex","title":"ibkr_porez.main.export_flex","text":"<pre><code>export_flex(date: str, output_path: str | None)\n</code></pre> <p>Export full flex query XML file for the given date.</p>"},{"location":"reference/#ibkr_porez.main.fetch","title":"ibkr_porez.main.fetch","text":"<pre><code>fetch()\n</code></pre> <p>Sync data from IBKR and NBS.</p>"},{"location":"reference/#ibkr_porez.main.ibkr_porez","title":"ibkr_porez.main.ibkr_porez","text":"<pre><code>ibkr_porez(ctx: Context) -&gt; None\n</code></pre> <p>Automated PPDG-3R and PP OPO tax reports for Interactive Brokers.</p> <p>Starts GUI when invoked without a subcommand.</p>"},{"location":"reference/#ibkr_porez.main.import_file","title":"ibkr_porez.main.import_file","text":"<pre><code>import_file(file_path: str | None, import_type: str)\n</code></pre> <p>Import historical transactions from CSV Activity Statement or Flex Query XML.</p>"},{"location":"reference/#ibkr_porez.main.list_declarations","title":"ibkr_porez.main.list_declarations","text":"<pre><code>list_declarations(all: bool, status: str | None, ids_only: bool)\n</code></pre> <p>List declarations (default: active = draft + submitted + pending).</p>"},{"location":"reference/#ibkr_porez.main.pay","title":"ibkr_porez.main.pay","text":"<pre><code>pay(declaration_id: str, tax_str: str | None)\n</code></pre> <p>Mark declaration as paid.</p> <p>Example: ibkr-porez pay 1 Example: ibkr-porez list --status draft -1 | xargs -I {} ibkr-porez pay {}</p>"},{"location":"reference/#ibkr_porez.main.report","title":"ibkr_porez.main.report","text":"<pre><code>report(type: str, half: str | None, start_date: str | None, end_date: str | None, force: bool, output_dir: str | None)\n</code></pre> <p>Generate tax reports (PPDG-3R for capital gains or PP OPO for capital income).</p>"},{"location":"reference/#ibkr_porez.main.revert","title":"ibkr_porez.main.revert","text":"<pre><code>revert(declaration_id: str, to: str)\n</code></pre> <p>Revert declaration status (e.g., finalized -&gt; draft).</p> <p>Example: ibkr-porez revert 1 Example: ibkr-porez list --status finalized -1 | xargs -I {} ibkr-porez revert {} --to draft</p>"},{"location":"reference/#ibkr_porez.main.show","title":"ibkr_porez.main.show","text":"<pre><code>show(declaration_id: str)\n</code></pre> <p>Show declaration details by ID.</p>"},{"location":"reference/#ibkr_porez.main.stat","title":"ibkr_porez.main.stat","text":"<pre><code>stat(year: int | None, ticker: str | None, month: str | None)\n</code></pre> <p>Show transaction statistics with optional filters.</p>"},{"location":"reference/#ibkr_porez.main.submit","title":"ibkr_porez.main.submit","text":"<pre><code>submit(declaration_id: str)\n</code></pre> <p>Mark declaration as submitted (imported to tax portal).</p> <p>Example: ibkr-porez submit 1 Example: ibkr-porez list --status draft -1 | xargs -I {} ibkr-porez submit {}</p>"},{"location":"reference/#ibkr_porez.main.sync","title":"ibkr_porez.main.sync","text":"<pre><code>sync(output_dir: str | None, forced_lookback_days: int | None)\n</code></pre> <p>Sync data from IBKR and create all necessary declarations.</p>"},{"location":"reference/#ibkr_porez.main.verbose_option","title":"ibkr_porez.main.verbose_option","text":"<pre><code>verbose_option(f)\n</code></pre>"},{"location":"reference/#ibkr_porez.models","title":"ibkr_porez.models","text":""},{"location":"reference/#ibkr_porez.models-attributes","title":"Attributes","text":""},{"location":"reference/#ibkr_porez.models.DECLARATION_STATUS_SCOPES","title":"ibkr_porez.models.DECLARATION_STATUS_SCOPES  <code>module-attribute</code>","text":"<pre><code>DECLARATION_STATUS_SCOPES: dict[str, tuple[DeclarationStatus, ...]] = {'Active': (DRAFT, SUBMITTED, PENDING), 'Pending payment': (SUBMITTED, PENDING)}\n</code></pre>"},{"location":"reference/#ibkr_porez.models.INCOME_CODE_COUPON","title":"ibkr_porez.models.INCOME_CODE_COUPON  <code>module-attribute</code>","text":"<pre><code>INCOME_CODE_COUPON = '111403000'\n</code></pre>"},{"location":"reference/#ibkr_porez.models.INCOME_CODE_DIVIDEND","title":"ibkr_porez.models.INCOME_CODE_DIVIDEND  <code>module-attribute</code>","text":"<pre><code>INCOME_CODE_DIVIDEND = '111402000'\n</code></pre>"},{"location":"reference/#ibkr_porez.models-classes","title":"Classes","text":""},{"location":"reference/#ibkr_porez.models.AssetClass","title":"ibkr_porez.models.AssetClass","text":"<p>               Bases: <code>StrEnum</code></p> Attributes <code></code> ibkr_porez.models.AssetClass.BOND <code>class-attribute</code> <code>instance-attribute</code> <pre><code>BOND = 'BOND'\n</code></pre> <code></code> ibkr_porez.models.AssetClass.CASH <code>class-attribute</code> <code>instance-attribute</code> <pre><code>CASH = 'CASH'\n</code></pre> <code></code> ibkr_porez.models.AssetClass.CFD <code>class-attribute</code> <code>instance-attribute</code> <pre><code>CFD = 'CFD'\n</code></pre> <code></code> ibkr_porez.models.AssetClass.OPTION <code>class-attribute</code> <code>instance-attribute</code> <pre><code>OPTION = 'OPT'\n</code></pre> <code></code> ibkr_porez.models.AssetClass.STOCK <code>class-attribute</code> <code>instance-attribute</code> <pre><code>STOCK = 'STK'\n</code></pre>"},{"location":"reference/#ibkr_porez.models.Currency","title":"ibkr_porez.models.Currency","text":"<p>               Bases: <code>StrEnum</code></p> Attributes <code></code> ibkr_porez.models.Currency.EUR <code>class-attribute</code> <code>instance-attribute</code> <pre><code>EUR = 'EUR'\n</code></pre> <code></code> ibkr_porez.models.Currency.GBP <code>class-attribute</code> <code>instance-attribute</code> <pre><code>GBP = 'GBP'\n</code></pre> <code></code> ibkr_porez.models.Currency.RSD <code>class-attribute</code> <code>instance-attribute</code> <pre><code>RSD = 'RSD'\n</code></pre> <code></code> ibkr_porez.models.Currency.USD <code>class-attribute</code> <code>instance-attribute</code> <pre><code>USD = 'USD'\n</code></pre>"},{"location":"reference/#ibkr_porez.models.Declaration","title":"ibkr_porez.models.Declaration","text":"<p>               Bases: <code>BaseModel</code></p> <p>Tax declaration with lifecycle management.</p> Attributes <code></code> ibkr_porez.models.Declaration.attached_files <code>class-attribute</code> <code>instance-attribute</code> <pre><code>attached_files: dict[str, str] = Field(default_factory=dict, description='Attached files: {file_identifier: relative_path}')\n</code></pre> <code></code> ibkr_porez.models.Declaration.created_at <code>instance-attribute</code> <pre><code>created_at: datetime\n</code></pre> <code></code> ibkr_porez.models.Declaration.declaration_id <code>class-attribute</code> <code>instance-attribute</code> <pre><code>declaration_id: str = Field(..., description='Unique declaration ID')\n</code></pre> <code></code> ibkr_porez.models.Declaration.file_path <code>class-attribute</code> <code>instance-attribute</code> <pre><code>file_path: str | None = None\n</code></pre> <code></code> ibkr_porez.models.Declaration.metadata <code>class-attribute</code> <code>instance-attribute</code> <pre><code>metadata: dict = Field(default_factory=dict)\n</code></pre> <code></code> ibkr_porez.models.Declaration.paid_at <code>class-attribute</code> <code>instance-attribute</code> <pre><code>paid_at: datetime | None = None\n</code></pre> <code></code> ibkr_porez.models.Declaration.period_end <code>instance-attribute</code> <pre><code>period_end: date\n</code></pre> <code></code> ibkr_porez.models.Declaration.period_start <code>instance-attribute</code> <pre><code>period_start: date\n</code></pre> <code></code> ibkr_porez.models.Declaration.report_data <code>class-attribute</code> <code>instance-attribute</code> <pre><code>report_data: list[TaxReportEntry | IncomeDeclarationEntry] | None = None\n</code></pre> <code></code> ibkr_porez.models.Declaration.status <code>class-attribute</code> <code>instance-attribute</code> <pre><code>status: DeclarationStatus = DRAFT\n</code></pre> <code></code> ibkr_porez.models.Declaration.submitted_at <code>class-attribute</code> <code>instance-attribute</code> <pre><code>submitted_at: datetime | None = None\n</code></pre> <code></code> ibkr_porez.models.Declaration.type <code>instance-attribute</code> <pre><code>type: DeclarationType\n</code></pre> <code></code> ibkr_porez.models.Declaration.xml_content <code>class-attribute</code> <code>instance-attribute</code> <pre><code>xml_content: str | None = None\n</code></pre> Functions <code></code> ibkr_porez.models.Declaration.display_period <pre><code>display_period() -&gt; str\n</code></pre> <p>Return user-facing period label.</p> <code></code> ibkr_porez.models.Declaration.display_tax <pre><code>display_tax() -&gt; str\n</code></pre> <p>Return user-facing tax amount.</p> <code></code> ibkr_porez.models.Declaration.display_type <pre><code>display_type() -&gt; str\n</code></pre> <p>Return user-facing declaration type label.</p>"},{"location":"reference/#ibkr_porez.models.DeclarationStatus","title":"ibkr_porez.models.DeclarationStatus","text":"<p>               Bases: <code>StrEnum</code></p> <p>Status of tax declaration.</p> Attributes <code></code> ibkr_porez.models.DeclarationStatus.DRAFT <code>class-attribute</code> <code>instance-attribute</code> <pre><code>DRAFT = 'draft'\n</code></pre> <code></code> ibkr_porez.models.DeclarationStatus.FINALIZED <code>class-attribute</code> <code>instance-attribute</code> <pre><code>FINALIZED = 'finalized'\n</code></pre> <code></code> ibkr_porez.models.DeclarationStatus.PENDING <code>class-attribute</code> <code>instance-attribute</code> <pre><code>PENDING = 'pending'\n</code></pre> <code></code> ibkr_porez.models.DeclarationStatus.SUBMITTED <code>class-attribute</code> <code>instance-attribute</code> <pre><code>SUBMITTED = 'submitted'\n</code></pre>"},{"location":"reference/#ibkr_porez.models.DeclarationType","title":"ibkr_porez.models.DeclarationType","text":"<p>               Bases: <code>StrEnum</code></p> <p>Type of tax declaration.</p> Attributes <code></code> ibkr_porez.models.DeclarationType.PPDG3R <code>class-attribute</code> <code>instance-attribute</code> <pre><code>PPDG3R = 'PPDG-3R'\n</code></pre> <code></code> ibkr_porez.models.DeclarationType.PPO <code>class-attribute</code> <code>instance-attribute</code> <pre><code>PPO = 'PP OPO'\n</code></pre>"},{"location":"reference/#ibkr_porez.models.ExchangeRate","title":"ibkr_porez.models.ExchangeRate","text":"<p>               Bases: <code>BaseModel</code></p> <p>NBS middle exchange rate for a specific date and currency.</p> Attributes <code></code> ibkr_porez.models.ExchangeRate.currency <code>instance-attribute</code> <pre><code>currency: Currency\n</code></pre> <code></code> ibkr_porez.models.ExchangeRate.date <code>instance-attribute</code> <pre><code>date: date\n</code></pre> <code></code> ibkr_porez.models.ExchangeRate.rate <code>instance-attribute</code> <pre><code>rate: Decimal\n</code></pre>"},{"location":"reference/#ibkr_porez.models.IncomeDeclarationEntry","title":"ibkr_porez.models.IncomeDeclarationEntry","text":"<p>               Bases: <code>BaseModel</code></p> <p>Single row in PP OPO declaration with calculated tax fields.</p> Attributes <code></code> ibkr_porez.models.IncomeDeclarationEntry.bruto_prihod <code>instance-attribute</code> <pre><code>bruto_prihod: Decimal\n</code></pre> <code></code> ibkr_porez.models.IncomeDeclarationEntry.date <code>instance-attribute</code> <pre><code>date: date\n</code></pre> <code></code> ibkr_porez.models.IncomeDeclarationEntry.obracunati_porez <code>instance-attribute</code> <pre><code>obracunati_porez: Decimal\n</code></pre> <code></code> ibkr_porez.models.IncomeDeclarationEntry.osnovica_za_porez <code>instance-attribute</code> <pre><code>osnovica_za_porez: Decimal\n</code></pre> <code></code> ibkr_porez.models.IncomeDeclarationEntry.porez_placen_drugoj_drzavi <code>instance-attribute</code> <pre><code>porez_placen_drugoj_drzavi: Decimal\n</code></pre> <code></code> ibkr_porez.models.IncomeDeclarationEntry.porez_za_uplatu <code>instance-attribute</code> <pre><code>porez_za_uplatu: Decimal\n</code></pre> <code></code> ibkr_porez.models.IncomeDeclarationEntry.sifra_vrste_prihoda <code>instance-attribute</code> <pre><code>sifra_vrste_prihoda: str\n</code></pre> <code></code> ibkr_porez.models.IncomeDeclarationEntry.symbol_or_currency <code>class-attribute</code> <code>instance-attribute</code> <pre><code>symbol_or_currency: str | None = None\n</code></pre>"},{"location":"reference/#ibkr_porez.models.IncomeEntry","title":"ibkr_porez.models.IncomeEntry","text":"<p>               Bases: <code>BaseModel</code></p> <p>Single income entry for PP OPO (Capital Income).</p> Attributes <code></code> ibkr_porez.models.IncomeEntry.amount <code>instance-attribute</code> <pre><code>amount: Decimal\n</code></pre> <code></code> ibkr_porez.models.IncomeEntry.amount_rsd <code>instance-attribute</code> <pre><code>amount_rsd: Decimal\n</code></pre> <code></code> ibkr_porez.models.IncomeEntry.currency <code>instance-attribute</code> <pre><code>currency: Currency\n</code></pre> <code></code> ibkr_porez.models.IncomeEntry.date <code>instance-attribute</code> <pre><code>date: date\n</code></pre> <code></code> ibkr_porez.models.IncomeEntry.description <code>instance-attribute</code> <pre><code>description: str\n</code></pre> <code></code> ibkr_porez.models.IncomeEntry.exchange_rate <code>instance-attribute</code> <pre><code>exchange_rate: Decimal\n</code></pre> <code></code> ibkr_porez.models.IncomeEntry.income_type <code>instance-attribute</code> <pre><code>income_type: str\n</code></pre> <code></code> ibkr_porez.models.IncomeEntry.symbol <code>instance-attribute</code> <pre><code>symbol: str\n</code></pre> <code></code> ibkr_porez.models.IncomeEntry.withholding_tax_rsd <code>class-attribute</code> <code>instance-attribute</code> <pre><code>withholding_tax_rsd: Decimal = Decimal('0.00')\n</code></pre> <code></code> ibkr_porez.models.IncomeEntry.withholding_tax_usd <code>class-attribute</code> <code>instance-attribute</code> <pre><code>withholding_tax_usd: Decimal = Decimal('0.00')\n</code></pre>"},{"location":"reference/#ibkr_porez.models.TaxReportEntry","title":"ibkr_porez.models.TaxReportEntry","text":"<p>               Bases: <code>BaseModel</code></p> <p>Single row in the final tax report.</p> Attributes <code></code> ibkr_porez.models.TaxReportEntry.capital_gain_rsd <code>instance-attribute</code> <pre><code>capital_gain_rsd: Decimal\n</code></pre> <code></code> ibkr_porez.models.TaxReportEntry.is_tax_exempt <code>class-attribute</code> <code>instance-attribute</code> <pre><code>is_tax_exempt: bool = False\n</code></pre> <code></code> ibkr_porez.models.TaxReportEntry.purchase_date <code>instance-attribute</code> <pre><code>purchase_date: date\n</code></pre> <code></code> ibkr_porez.models.TaxReportEntry.purchase_exchange_rate <code>instance-attribute</code> <pre><code>purchase_exchange_rate: Decimal\n</code></pre> <code></code> ibkr_porez.models.TaxReportEntry.purchase_price <code>instance-attribute</code> <pre><code>purchase_price: Decimal\n</code></pre> <code></code> ibkr_porez.models.TaxReportEntry.purchase_value_rsd <code>instance-attribute</code> <pre><code>purchase_value_rsd: Decimal\n</code></pre> <code></code> ibkr_porez.models.TaxReportEntry.quantity <code>instance-attribute</code> <pre><code>quantity: Decimal\n</code></pre> <code></code> ibkr_porez.models.TaxReportEntry.sale_date <code>instance-attribute</code> <pre><code>sale_date: date\n</code></pre> <code></code> ibkr_porez.models.TaxReportEntry.sale_exchange_rate <code>instance-attribute</code> <pre><code>sale_exchange_rate: Decimal\n</code></pre> <code></code> ibkr_porez.models.TaxReportEntry.sale_price <code>instance-attribute</code> <pre><code>sale_price: Decimal\n</code></pre> <code></code> ibkr_porez.models.TaxReportEntry.sale_value_rsd <code>instance-attribute</code> <pre><code>sale_value_rsd: Decimal\n</code></pre> <code></code> ibkr_porez.models.TaxReportEntry.ticker <code>instance-attribute</code> <pre><code>ticker: str\n</code></pre>"},{"location":"reference/#ibkr_porez.models.Transaction","title":"ibkr_porez.models.Transaction","text":"<p>               Bases: <code>BaseModel</code></p> <p>Represents a single financial event (trade, dividend, tax).</p> Attributes <code></code> ibkr_porez.models.Transaction.amount <code>class-attribute</code> <code>instance-attribute</code> <pre><code>amount: Decimal = Field(..., description='Total amount in original currency')\n</code></pre> <code></code> ibkr_porez.models.Transaction.amount_rsd <code>class-attribute</code> <code>instance-attribute</code> <pre><code>amount_rsd: Decimal | None = None\n</code></pre> <code></code> ibkr_porez.models.Transaction.currency <code>instance-attribute</code> <pre><code>currency: Currency\n</code></pre> <code></code> ibkr_porez.models.Transaction.date <code>instance-attribute</code> <pre><code>date: date\n</code></pre> <code></code> ibkr_porez.models.Transaction.description <code>instance-attribute</code> <pre><code>description: str\n</code></pre> <code></code> ibkr_porez.models.Transaction.exchange_rate <code>class-attribute</code> <code>instance-attribute</code> <pre><code>exchange_rate: Decimal | None = None\n</code></pre> <code></code> ibkr_porez.models.Transaction.open_date <code>class-attribute</code> <code>instance-attribute</code> <pre><code>open_date: date | None = None\n</code></pre> <code></code> ibkr_porez.models.Transaction.open_price <code>class-attribute</code> <code>instance-attribute</code> <pre><code>open_price: Decimal | None = None\n</code></pre> <code></code> ibkr_porez.models.Transaction.price <code>class-attribute</code> <code>instance-attribute</code> <pre><code>price: Decimal = Decimal(0)\n</code></pre> <code></code> ibkr_porez.models.Transaction.quantity <code>class-attribute</code> <code>instance-attribute</code> <pre><code>quantity: Decimal = Decimal(0)\n</code></pre> <code></code> ibkr_porez.models.Transaction.symbol <code>instance-attribute</code> <pre><code>symbol: str\n</code></pre> <code></code> ibkr_porez.models.Transaction.transaction_id <code>class-attribute</code> <code>instance-attribute</code> <pre><code>transaction_id: str = Field(..., description='Unique ID from IBKR (e.g. tradeID)')\n</code></pre> <code></code> ibkr_porez.models.Transaction.type <code>instance-attribute</code> <pre><code>type: TransactionType\n</code></pre>"},{"location":"reference/#ibkr_porez.models.TransactionType","title":"ibkr_porez.models.TransactionType","text":"<p>               Bases: <code>StrEnum</code></p> Attributes <code></code> ibkr_porez.models.TransactionType.DIVIDEND <code>class-attribute</code> <code>instance-attribute</code> <pre><code>DIVIDEND = 'DIVIDEND'\n</code></pre> <code></code> ibkr_porez.models.TransactionType.INTEREST <code>class-attribute</code> <code>instance-attribute</code> <pre><code>INTEREST = 'INTEREST'\n</code></pre> <code></code> ibkr_porez.models.TransactionType.TAX <code>class-attribute</code> <code>instance-attribute</code> <pre><code>TAX = 'TAX'\n</code></pre> <code></code> ibkr_porez.models.TransactionType.TRADE <code>class-attribute</code> <code>instance-attribute</code> <pre><code>TRADE = 'TRADE'\n</code></pre> <code></code> ibkr_porez.models.TransactionType.WITHHOLDING_TAX <code>class-attribute</code> <code>instance-attribute</code> <pre><code>WITHHOLDING_TAX = 'WITHHOLDING_TAX'\n</code></pre>"},{"location":"reference/#ibkr_porez.models.UserConfig","title":"ibkr_porez.models.UserConfig","text":"<p>               Bases: <code>BaseModel</code></p> <p>User configuration stored on disk.</p> Attributes <code></code> ibkr_porez.models.UserConfig.address <code>instance-attribute</code> <pre><code>address: str\n</code></pre> <code></code> ibkr_porez.models.UserConfig.city_code <code>class-attribute</code> <code>instance-attribute</code> <pre><code>city_code: str = '223'\n</code></pre> <code></code> ibkr_porez.models.UserConfig.data_dir <code>class-attribute</code> <code>instance-attribute</code> <pre><code>data_dir: str | None = None\n</code></pre> <code></code> ibkr_porez.models.UserConfig.email <code>class-attribute</code> <code>instance-attribute</code> <pre><code>email: str = 'email@example.com'\n</code></pre> <code></code> ibkr_porez.models.UserConfig.full_name <code>instance-attribute</code> <pre><code>full_name: str\n</code></pre> <code></code> ibkr_porez.models.UserConfig.ibkr_query_id <code>class-attribute</code> <code>instance-attribute</code> <pre><code>ibkr_query_id: str = ''\n</code></pre> <code></code> ibkr_porez.models.UserConfig.ibkr_token <code>class-attribute</code> <code>instance-attribute</code> <pre><code>ibkr_token: str = ''\n</code></pre> <code></code> ibkr_porez.models.UserConfig.output_folder <code>class-attribute</code> <code>instance-attribute</code> <pre><code>output_folder: str | None = None\n</code></pre> <code></code> ibkr_porez.models.UserConfig.personal_id <code>class-attribute</code> <code>instance-attribute</code> <pre><code>personal_id: str = ''\n</code></pre> <code></code> ibkr_porez.models.UserConfig.phone <code>class-attribute</code> <code>instance-attribute</code> <pre><code>phone: str = '0600000000'\n</code></pre>"},{"location":"reference/#ibkr_porez.nbs","title":"ibkr_porez.nbs","text":""},{"location":"reference/#ibkr_porez.nbs-attributes","title":"Attributes","text":""},{"location":"reference/#ibkr_porez.nbs.logger","title":"ibkr_porez.nbs.logger  <code>module-attribute</code>","text":"<pre><code>logger = getLogger(__name__)\n</code></pre>"},{"location":"reference/#ibkr_porez.nbs-classes","title":"Classes","text":""},{"location":"reference/#ibkr_porez.nbs.NBSClient","title":"ibkr_porez.nbs.NBSClient","text":"Attributes ibkr_porez.nbs.NBSClient.BASE_URL <code>class-attribute</code> <code>instance-attribute</code> <pre><code>BASE_URL = 'https://kurs.resenje.org/api/v1'\n</code></pre> <code></code> ibkr_porez.nbs.NBSClient.storage <code>instance-attribute</code> <pre><code>storage = storage\n</code></pre> Functions <code></code> ibkr_porez.nbs.NBSClient.get_rate <pre><code>get_rate(date_obj: date, currency: Currency) -&gt; Decimal | None\n</code></pre> <p>Get NBS middle rate for currency on date. Uses cache if available.</p>"},{"location":"reference/#ibkr_porez.operation_config","title":"ibkr_porez.operation_config","text":"<p>Operation for configuring IBKR and personal details.</p>"},{"location":"reference/#ibkr_porez.operation_config-attributes","title":"Attributes","text":""},{"location":"reference/#ibkr_porez.operation_config-classes","title":"Classes","text":""},{"location":"reference/#ibkr_porez.operation_config-functions","title":"Functions","text":""},{"location":"reference/#ibkr_porez.operation_config.execute_config_command","title":"ibkr_porez.operation_config.execute_config_command","text":"<pre><code>execute_config_command(console: Console) -&gt; None\n</code></pre> <p>Execute configuration command.</p>"},{"location":"reference/#ibkr_porez.operation_get","title":"ibkr_porez.operation_get","text":"<p>Operation for fetching data from IBKR and NBS.</p>"},{"location":"reference/#ibkr_porez.operation_get-classes","title":"Classes","text":""},{"location":"reference/#ibkr_porez.operation_get.GetOperation","title":"ibkr_porez.operation_get.GetOperation","text":"<p>Operation for fetching data from IBKR and NBS.</p> Attributes ibkr_porez.operation_get.GetOperation.config <code>instance-attribute</code> <pre><code>config = config\n</code></pre> <code></code> ibkr_porez.operation_get.GetOperation.ibkr <code>instance-attribute</code> <pre><code>ibkr = IBKRClient(ibkr_token, ibkr_query_id)\n</code></pre> <code></code> ibkr_porez.operation_get.GetOperation.nbs <code>instance-attribute</code> <pre><code>nbs = NBSClient(storage)\n</code></pre> <code></code> ibkr_porez.operation_get.GetOperation.storage <code>instance-attribute</code> <pre><code>storage = Storage()\n</code></pre> Functions <code></code> ibkr_porez.operation_get.GetOperation.execute <pre><code>execute() -&gt; tuple[list[Transaction], int, int]\n</code></pre> <p>Execute get operation.</p> <p>Returns:</p> Type Description <code>tuple[list[Transaction], int, int]</code> <p>tuple[list[Transaction], int, int]: (transactions, count_inserted, count_updated)</p> <code></code> ibkr_porez.operation_get.GetOperation.process_flex_query <pre><code>process_flex_query(xml_content: str | bytes, report_date: date) -&gt; tuple[list[Transaction], int, int]\n</code></pre> <p>Process flex query XML content (common logic for get and import-flex).</p> <p>Parameters:</p> Name Type Description Default <code>xml_content</code> <code>str | bytes</code> <p>XML content as string or bytes</p> required <code>report_date</code> <code>date</code> <p>Date of the report</p> required <p>Returns:</p> Type Description <code>tuple[list[Transaction], int, int]</code> <p>tuple[list[Transaction], int, int]: (transactions, count_inserted, count_updated)</p>"},{"location":"reference/#ibkr_porez.operation_get-functions","title":"Functions","text":""},{"location":"reference/#ibkr_porez.operation_import","title":"ibkr_porez.operation_import","text":"<p>Operation for importing data from CSV or Flex Query XML files.</p>"},{"location":"reference/#ibkr_porez.operation_import-classes","title":"Classes","text":""},{"location":"reference/#ibkr_porez.operation_import.ImportOperation","title":"ibkr_porez.operation_import.ImportOperation","text":"<p>Operation for importing data from CSV or Flex Query XML files.</p> Attributes ibkr_porez.operation_import.ImportOperation.get_operation <code>instance-attribute</code> <pre><code>get_operation = GetOperation(config=None)\n</code></pre> <code></code> ibkr_porez.operation_import.ImportOperation.nbs <code>instance-attribute</code> <pre><code>nbs = NBSClient(storage)\n</code></pre> <code></code> ibkr_porez.operation_import.ImportOperation.storage <code>instance-attribute</code> <pre><code>storage = Storage()\n</code></pre> Functions <code></code> ibkr_porez.operation_import.ImportOperation.execute <pre><code>execute(file_path: Path, import_type: ImportType = AUTO) -&gt; tuple[list[Transaction], int, int]\n</code></pre> <p>Execute import operation.</p> <p>Parameters:</p> Name Type Description Default <code>file_path</code> <code>Path</code> <p>Path to the file to import</p> required <code>import_type</code> <code>ImportType</code> <p>Type of import (CSV, FLEX, or AUTO for auto-detection)</p> <code>AUTO</code> <p>Returns:</p> Type Description <code>tuple[list[Transaction], int, int]</code> <p>tuple[list[Transaction], int, int]: (transactions, count_inserted, count_updated)</p> <p>Raises:</p> Type Description <code>ValueError</code> <p>If file cannot be parsed or import type is invalid</p>"},{"location":"reference/#ibkr_porez.operation_import.ImportType","title":"ibkr_porez.operation_import.ImportType","text":"<p>               Bases: <code>StrEnum</code></p> <p>Import file type.</p> Attributes <code></code> ibkr_porez.operation_import.ImportType.AUTO <code>class-attribute</code> <code>instance-attribute</code> <pre><code>AUTO = 'auto'\n</code></pre> <code></code> ibkr_porez.operation_import.ImportType.CSV <code>class-attribute</code> <code>instance-attribute</code> <pre><code>CSV = 'csv'\n</code></pre> <code></code> ibkr_porez.operation_import.ImportType.FLEX <code>class-attribute</code> <code>instance-attribute</code> <pre><code>FLEX = 'flex'\n</code></pre>"},{"location":"reference/#ibkr_porez.operation_list","title":"ibkr_porez.operation_list","text":"<p>List declarations command implementation.</p>"},{"location":"reference/#ibkr_porez.operation_list-attributes","title":"Attributes","text":""},{"location":"reference/#ibkr_porez.operation_list-classes","title":"Classes","text":""},{"location":"reference/#ibkr_porez.operation_list.ListDeclarations","title":"ibkr_porez.operation_list.ListDeclarations","text":"<p>Controller for list command.</p> Attributes ibkr_porez.operation_list.ListDeclarations.storage <code>instance-attribute</code> <pre><code>storage = Storage()\n</code></pre> Functions <code></code> ibkr_porez.operation_list.ListDeclarations.generate <pre><code>generate(show_all: bool = False, status: DeclarationStatus | None = None, ids_only: bool = False) -&gt; Table | list[str]\n</code></pre> <p>Generate declarations list table or IDs only.</p> <p>Parameters:</p> Name Type Description Default <code>show_all</code> <code>bool</code> <p>If True, show all declarations regardless of status</p> <code>False</code> <code>status</code> <code>DeclarationStatus | None</code> <p>Filter by specific status</p> <code>None</code> <code>ids_only</code> <code>bool</code> <p>If True, return list of IDs instead of table</p> <code>False</code> <p>Returns:</p> Type Description <code>Table | list[str]</code> <p>Table or list[str]: Rich table with declarations or list of IDs</p>"},{"location":"reference/#ibkr_porez.operation_report","title":"ibkr_porez.operation_report","text":"<p>Report command implementation.</p>"},{"location":"reference/#ibkr_porez.operation_report-classes","title":"Classes","text":""},{"location":"reference/#ibkr_porez.operation_report-functions","title":"Functions","text":""},{"location":"reference/#ibkr_porez.operation_report.display_income_declaration","title":"ibkr_porez.operation_report.display_income_declaration","text":"<pre><code>display_income_declaration(entry: IncomeDeclarationEntry, console: Console) -&gt; None\n</code></pre> <p>Display a single income declaration entry.</p> <p>Parameters:</p> Name Type Description Default <code>entry</code> <code>IncomeDeclarationEntry</code> <p>Income declaration entry to display.</p> required <code>console</code> <code>Console</code> <p>Rich console for output.</p> required"},{"location":"reference/#ibkr_porez.operation_report.execute_report_command","title":"ibkr_porez.operation_report.execute_report_command","text":"<pre><code>execute_report_command(type: str, half: str | None, start_date: str | None, end_date: str | None, console: Console, force: bool = False, output_dir: Path | None = None) -&gt; None\n</code></pre> <p>Execute the report command.</p> <p>Parameters:</p> Name Type Description Default <code>type</code> <code>str</code> <p>Report type ('gains' or 'income').</p> required <code>half</code> <code>str | None</code> <p>Half-year period (e.g. 2026-1, 20261).</p> required <code>start_date</code> <code>str | None</code> <p>Start date string (YYYY-MM-DD).</p> required <code>end_date</code> <code>str | None</code> <p>End date string (YYYY-MM-DD).</p> required <code>console</code> <code>Console</code> <p>Rich console for output.</p> required <code>force</code> <code>bool</code> <p>If True, create income declaration with zero tax even if withholding tax not found.</p> <code>False</code> <code>output_dir</code> <code>Path | None</code> <p>Optional output directory (default: from config or Downloads).</p> <code>None</code>"},{"location":"reference/#ibkr_porez.operation_report.generate_gains_filename","title":"ibkr_porez.operation_report.generate_gains_filename","text":"<pre><code>generate_gains_filename(half: str | None) -&gt; str | None\n</code></pre> <p>Generate filename for gains report from half-year parameter.</p> <p>Parameters:</p> Name Type Description Default <code>half</code> <code>str | None</code> <p>Half-year period (e.g. 2026-1, 20261).</p> required <p>Returns:</p> Type Description <code>str | None</code> <p>Filename if half is provided and valid, None otherwise.</p>"},{"location":"reference/#ibkr_porez.operation_report.process_gains_report","title":"ibkr_porez.operation_report.process_gains_report","text":"<pre><code>process_gains_report(start_date: date, end_date: date, filename: str | None, console: Console, output_dir: Path | None = None) -&gt; None\n</code></pre> <p>Process and display gains report (PPDG-3R).</p> <p>Parameters:</p> Name Type Description Default <code>start_date</code> <code>date</code> <p>Start date for the report period.</p> required <code>end_date</code> <code>date</code> <p>End date for the report period.</p> required <code>filename</code> <code>str | None</code> <p>Optional filename for the report.</p> required <code>console</code> <code>Console</code> <p>Rich console for output.</p> required <code>output_dir</code> <code>Path | None</code> <p>Optional output directory (default: from config or Downloads).</p> <code>None</code>"},{"location":"reference/#ibkr_porez.operation_report.process_income_report","title":"ibkr_porez.operation_report.process_income_report","text":"<pre><code>process_income_report(start_date: date, end_date: date, console: Console, force: bool = False, output_dir: Path | None = None) -&gt; None\n</code></pre> <p>Process and display income report (PP OPO).</p> <p>Parameters:</p> Name Type Description Default <code>start_date</code> <code>date</code> <p>Start date for the report period.</p> required <code>end_date</code> <code>date</code> <p>End date for the report period.</p> required <code>console</code> <code>Console</code> <p>Rich console for output.</p> required <code>force</code> <code>bool</code> <p>If True, create declaration with zero tax even if withholding tax not found.</p> <code>False</code> <code>output_dir</code> <code>Path | None</code> <p>Optional output directory (default: from config or Downloads).</p> <code>None</code>"},{"location":"reference/#ibkr_porez.operation_report_params","title":"ibkr_porez.operation_report_params","text":"<p>Parameter validation for report commands.</p>"},{"location":"reference/#ibkr_porez.operation_report_params-classes","title":"Classes","text":""},{"location":"reference/#ibkr_porez.operation_report_params.ReportParams","title":"ibkr_porez.operation_report_params.ReportParams","text":"<p>               Bases: <code>BaseModel</code></p> <p>Validated parameters for report generation.</p> Attributes <code></code> ibkr_porez.operation_report_params.ReportParams.end_date <code>class-attribute</code> <code>instance-attribute</code> <pre><code>end_date: str | None = Field(None, alias='end')\n</code></pre> <code></code> ibkr_porez.operation_report_params.ReportParams.force <code>class-attribute</code> <code>instance-attribute</code> <pre><code>force: bool = False\n</code></pre> <code></code> ibkr_porez.operation_report_params.ReportParams.half <code>class-attribute</code> <code>instance-attribute</code> <pre><code>half: str | None = None\n</code></pre> <code></code> ibkr_porez.operation_report_params.ReportParams.start_date <code>class-attribute</code> <code>instance-attribute</code> <pre><code>start_date: str | None = Field(None, alias='start')\n</code></pre> <code></code> ibkr_porez.operation_report_params.ReportParams.type <code>class-attribute</code> <code>instance-attribute</code> <pre><code>type: ReportType = GAINS\n</code></pre> Functions <code></code> ibkr_porez.operation_report_params.ReportParams.get_period <pre><code>get_period() -&gt; tuple[date, date]\n</code></pre> <p>Determine report period based on parameters.</p> <p>Returns:</p> Type Description <code>tuple[date, date]</code> <p>tuple[date, date]: (start_date, end_date)</p> <p>Raises:</p> Type Description <code>ValueError</code> <p>If period cannot be determined.</p> <code></code> ibkr_porez.operation_report_params.ReportParams.validate_date_format <code>classmethod</code> <pre><code>validate_date_format(v: str | None) -&gt; str | None\n</code></pre> <p>Validate date string format.</p> <code></code> ibkr_porez.operation_report_params.ReportParams.validate_date_range <pre><code>validate_date_range() -&gt; ReportParams\n</code></pre> <p>Validate that start date is before or equal to end date.</p> <code></code> ibkr_porez.operation_report_params.ReportParams.validate_half_format <code>classmethod</code> <pre><code>validate_half_format(v: str | None) -&gt; str | None\n</code></pre> <p>Validate half-year string format.</p>"},{"location":"reference/#ibkr_porez.operation_report_params.ReportType","title":"ibkr_porez.operation_report_params.ReportType","text":"<p>               Bases: <code>StrEnum</code></p> <p>Report type enumeration.</p> Attributes <code></code> ibkr_porez.operation_report_params.ReportType.GAINS <code>class-attribute</code> <code>instance-attribute</code> <pre><code>GAINS = 'gains'\n</code></pre> <code></code> ibkr_porez.operation_report_params.ReportType.INCOME <code>class-attribute</code> <code>instance-attribute</code> <pre><code>INCOME = 'income'\n</code></pre>"},{"location":"reference/#ibkr_porez.operation_report_tables","title":"ibkr_porez.operation_report_tables","text":"<p>Table rendering for tax reports.</p>"},{"location":"reference/#ibkr_porez.operation_report_tables-classes","title":"Classes","text":""},{"location":"reference/#ibkr_porez.operation_report_tables-functions","title":"Functions","text":""},{"location":"reference/#ibkr_porez.operation_report_tables.render_declaration_table","title":"ibkr_porez.operation_report_tables.render_declaration_table","text":"<pre><code>render_declaration_table(entries: list[TaxReportEntry]) -&gt; Table\n</code></pre> <p>Render declaration data table (Part 4 of PPDG-3R).</p> <p>This table shows the tabular part of the declaration with all entries.</p> <p>Parameters:</p> Name Type Description Default <code>entries</code> <code>list[TaxReportEntry]</code> <p>List of tax report entries.</p> required <p>Returns:</p> Name Type Description <code>Table</code> <code>Table</code> <p>Rich table with declaration data.</p>"},{"location":"reference/#ibkr_porez.operation_show_declaration","title":"ibkr_porez.operation_show_declaration","text":"<p>Display declaration details.</p>"},{"location":"reference/#ibkr_porez.operation_show_declaration-classes","title":"Classes","text":""},{"location":"reference/#ibkr_porez.operation_show_declaration-functions","title":"Functions","text":""},{"location":"reference/#ibkr_porez.operation_show_declaration.render_declaration_details_text","title":"ibkr_porez.operation_show_declaration.render_declaration_details_text","text":"<pre><code>render_declaration_details_text(declaration_id: str) -&gt; str\n</code></pre> <p>Render declaration details exactly as CLI <code>show</code> output text.</p>"},{"location":"reference/#ibkr_porez.operation_show_declaration.show_declaration","title":"ibkr_porez.operation_show_declaration.show_declaration","text":"<pre><code>show_declaration(declaration_id: str, console: Console) -&gt; None\n</code></pre> <p>Display declaration details by ID.</p> <p>Parameters:</p> Name Type Description Default <code>declaration_id</code> <code>str</code> <p>Declaration ID to display.</p> required <code>console</code> <code>Console</code> <p>Rich console for output.</p> required"},{"location":"reference/#ibkr_porez.operation_stat","title":"ibkr_porez.operation_stat","text":"<p>Controller for show command.</p>"},{"location":"reference/#ibkr_porez.operation_stat-classes","title":"Classes","text":""},{"location":"reference/#ibkr_porez.operation_stat.ShowStatistics","title":"ibkr_porez.operation_stat.ShowStatistics","text":"Attributes ibkr_porez.operation_stat.ShowStatistics.nbs <code>instance-attribute</code> <pre><code>nbs = NBSClient(storage)\n</code></pre> <code></code> ibkr_porez.operation_stat.ShowStatistics.storage <code>instance-attribute</code> <pre><code>storage = Storage()\n</code></pre> <code></code> ibkr_porez.operation_stat.ShowStatistics.tax_calc <code>instance-attribute</code> <pre><code>tax_calc = TaxCalculator(nbs)\n</code></pre> Functions <code></code> ibkr_porez.operation_stat.ShowStatistics.create_aggregated_table <pre><code>create_aggregated_table(stats: dict[str, dict[str, dict[str, Decimal | int]]]) -&gt; Table\n</code></pre> <p>Create aggregated monthly report table.</p> <p>Parameters:</p> Name Type Description Default <code>stats</code> <code>dict[str, dict[str, dict[str, Decimal | int]]]</code> <p>Statistics dictionary from get_aggregated_stats.</p> required <p>Returns:</p> Name Type Description <code>Table</code> <code>Table</code> <p>Formatted table.</p> <code></code> ibkr_porez.operation_stat.ShowStatistics.create_detailed_table <pre><code>create_detailed_table(entries: list[TaxReportEntry], ticker: str | None, year: int | None, month: int | None) -&gt; tuple[Table, Decimal]\n</code></pre> <p>Create detailed table for sales entries.</p> <p>Parameters:</p> Name Type Description Default <code>entries</code> <code>list[TaxReportEntry]</code> <p>List of sales entries to display.</p> required <code>ticker</code> <code>str | None</code> <p>Ticker filter (for title).</p> required <code>year</code> <code>int | None</code> <p>Year filter (for title).</p> required <code>month</code> <code>int | None</code> <p>Month filter (for title).</p> required <p>Returns:</p> Type Description <code>tuple[Table, Decimal]</code> <p>tuple[Table, Decimal]: (table, total_pnl)</p> <code></code> ibkr_porez.operation_stat.ShowStatistics.generate <pre><code>generate(year: int | None = None, ticker: str | None = None, month: str | None = None) -&gt; tuple[Table | None, Decimal | None, str | None]\n</code></pre> <p>Generate statistics display.</p> <p>Parameters:</p> Name Type Description Default <code>year</code> <code>int | None</code> <p>Filter by year (optional).</p> <code>None</code> <code>ticker</code> <code>str | None</code> <p>Filter by ticker (optional).</p> <code>None</code> <code>month</code> <code>str | None</code> <p>Filter by month in format YYYY-MM, YYYYMM, or MM (optional).</p> <code>None</code> <p>Returns:</p> Type Description <code>Table | None</code> <p>tuple[Table | None, Decimal | None, str | None]: (table, total_pnl, error_message)</p> <code>Decimal | None</code> <ul> <li>If detailed view: returns (table, total_pnl, None)</li> </ul> <code>str | None</code> <ul> <li>If aggregated view: returns (table, None, None)</li> </ul> <code>tuple[Table | None, Decimal | None, str | None]</code> <ul> <li>If error: returns (None, None, error_message)</li> </ul> <code>tuple[Table | None, Decimal | None, str | None]</code> <ul> <li>If no data: returns (None, None, error_message)</li> </ul> <p>Raises:</p> Type Description <code>ValueError</code> <p>If month format is invalid.</p> <code></code> ibkr_porez.operation_stat.ShowStatistics.get_aggregated_stats <pre><code>get_aggregated_stats(sales_entries: list[TaxReportEntry], df_transactions: DataFrame, ticker: str | None, year: int | None, month: int | None) -&gt; dict[str, dict[str, dict[str, Decimal | int]]]\n</code></pre> <p>Calculate aggregated statistics by month and ticker.</p> <p>Parameters:</p> Name Type Description Default <code>sales_entries</code> <code>list[TaxReportEntry]</code> <p>List of all sales entries.</p> required <code>df_transactions</code> <code>DataFrame</code> <p>DataFrame with all transactions.</p> required <code>ticker</code> <code>str | None</code> <p>Filter by ticker (optional).</p> required <code>year</code> <code>int | None</code> <p>Filter by year (optional).</p> required <code>month</code> <code>int | None</code> <p>Filter by month (optional).</p> required <p>Returns:</p> Name Type Description <code>dict</code> <code>dict[str, dict[str, dict[str, Decimal | int]]]</code> <p>Nested dict structure:</p> <code>dict[str, dict[str, dict[str, Decimal | int]]]</code> <p>{ \"YYYY-MM\": { \"TICKER\": { \"divs\": Decimal, \"sales_count\": int, \"pnl\": Decimal } } }</p> <code></code> ibkr_porez.operation_stat.ShowStatistics.get_detailed_entries <pre><code>get_detailed_entries(sales_entries: list[TaxReportEntry], ticker: str | None, year: int | None, month: int | None) -&gt; list[TaxReportEntry]\n</code></pre> <p>Filter sales entries for detailed view.</p> <p>Parameters:</p> Name Type Description Default <code>sales_entries</code> <code>list[TaxReportEntry]</code> <p>List of all sales entries.</p> required <code>ticker</code> <code>str | None</code> <p>Filter by ticker (optional).</p> required <code>year</code> <code>int | None</code> <p>Filter by year (optional).</p> required <code>month</code> <code>int | None</code> <p>Filter by month (optional).</p> required <p>Returns:</p> Type Description <code>list[TaxReportEntry]</code> <p>list[TaxReportEntry]: Filtered entries.</p> <code></code> ibkr_porez.operation_stat.ShowStatistics.parse_month <pre><code>parse_month(month: str | None) -&gt; tuple[int | None, int | None]\n</code></pre> <p>Parse month argument.</p> <p>Parameters:</p> Name Type Description Default <code>month</code> <code>str | None</code> <p>Month string in format YYYY-MM, YYYYMM, or MM.</p> required <p>Returns:</p> Type Description <code>tuple[int | None, int | None]</code> <p>tuple[int | None, int | None]: (target_year, target_month)</p> <p>Raises:</p> Type Description <code>ValueError</code> <p>If month format is invalid.</p> <code></code> ibkr_porez.operation_stat.ShowStatistics.resolve_month_year <pre><code>resolve_month_year(month: int | None, year: int | None, sales_entries: list[TaxReportEntry], df_transactions: DataFrame) -&gt; tuple[int, int]\n</code></pre> <p>Resolve target year and month from parameters.</p> <p>If only month is provided, finds the latest year with data for that month.</p> <p>Parameters:</p> Name Type Description Default <code>month</code> <code>int | None</code> <p>Target month (1-12) or None.</p> required <code>year</code> <code>int | None</code> <p>Target year or None.</p> required <code>sales_entries</code> <code>list[TaxReportEntry]</code> <p>List of sales entries to search for data.</p> required <code>df_transactions</code> <code>DataFrame</code> <p>DataFrame with all transactions.</p> required <p>Returns:</p> Type Description <code>tuple[int, int]</code> <p>tuple[int, int]: (target_year, target_month)</p>"},{"location":"reference/#ibkr_porez.operation_sync","title":"ibkr_porez.operation_sync","text":"<p>Operation for syncing data and creating declarations.</p>"},{"location":"reference/#ibkr_porez.operation_sync-attributes","title":"Attributes","text":""},{"location":"reference/#ibkr_porez.operation_sync-classes","title":"Classes","text":""},{"location":"reference/#ibkr_porez.operation_sync.DeclarationConfig","title":"ibkr_porez.operation_sync.DeclarationConfig  <code>dataclass</code>","text":"<p>Configuration for a declaration type.</p> Attributes ibkr_porez.operation_sync.DeclarationConfig.declaration_id_generator <code>instance-attribute</code> <pre><code>declaration_id_generator: Callable[..., str] | None\n</code></pre> <code></code> ibkr_porez.operation_sync.DeclarationConfig.declaration_type <code>instance-attribute</code> <pre><code>declaration_type: DeclarationType\n</code></pre> <code></code> ibkr_porez.operation_sync.DeclarationConfig.force <code>class-attribute</code> <code>instance-attribute</code> <pre><code>force: bool = False\n</code></pre> <code></code> ibkr_porez.operation_sync.DeclarationConfig.generator_factory <code>instance-attribute</code> <pre><code>generator_factory: Callable[[], Any]\n</code></pre> <code></code> ibkr_porez.operation_sync.DeclarationConfig.metadata_extractor <code>instance-attribute</code> <pre><code>metadata_extractor: Callable[[list, date, date], dict[str, Any]]\n</code></pre> <code></code> ibkr_porez.operation_sync.DeclarationConfig.period_getter <code>instance-attribute</code> <pre><code>period_getter: Callable[[], list[tuple[date, date, dict[str, Any]]]]\n</code></pre>"},{"location":"reference/#ibkr_porez.operation_sync.SyncOperation","title":"ibkr_porez.operation_sync.SyncOperation","text":"<p>Operation for syncing data and creating declarations.</p> Attributes ibkr_porez.operation_sync.SyncOperation.DEFAULT_FIRST_SYNC_LOOKBACK_DAYS <code>class-attribute</code> <code>instance-attribute</code> <pre><code>DEFAULT_FIRST_SYNC_LOOKBACK_DAYS = 45\n</code></pre> <code></code> ibkr_porez.operation_sync.SyncOperation.JULY_MONTH <code>class-attribute</code> <code>instance-attribute</code> <pre><code>JULY_MONTH = 7\n</code></pre> <code></code> ibkr_porez.operation_sync.SyncOperation.JUNE_MONTH <code>class-attribute</code> <code>instance-attribute</code> <pre><code>JUNE_MONTH = 6\n</code></pre> <code></code> ibkr_porez.operation_sync.SyncOperation.config <code>instance-attribute</code> <pre><code>config = config\n</code></pre> <code></code> ibkr_porez.operation_sync.SyncOperation.forced_lookback_days <code>instance-attribute</code> <pre><code>forced_lookback_days = forced_lookback_days\n</code></pre> <code></code> ibkr_porez.operation_sync.SyncOperation.get_operation <code>instance-attribute</code> <pre><code>get_operation = GetOperation(config)\n</code></pre> <code></code> ibkr_porez.operation_sync.SyncOperation.output_dir <code>instance-attribute</code> <pre><code>output_dir = output_dir\n</code></pre> <code></code> ibkr_porez.operation_sync.SyncOperation.storage <code>instance-attribute</code> <pre><code>storage = Storage()\n</code></pre> Functions <code></code> ibkr_porez.operation_sync.SyncOperation.execute <pre><code>execute() -&gt; list[Declaration]\n</code></pre> <p>Execute sync operation.</p> <p>Returns:</p> Type Description <code>list[Declaration]</code> <p>list[Declaration]: List of newly created declarations</p> <code></code> ibkr_porez.operation_sync.SyncOperation.get_output_folder <pre><code>get_output_folder() -&gt; Path\n</code></pre> <p>Get destination folder for declaration files.</p>"},{"location":"reference/#ibkr_porez.operation_sync-functions","title":"Functions","text":""},{"location":"reference/#ibkr_porez.report_base","title":"ibkr_porez.report_base","text":"<p>Base class for report generators.</p>"},{"location":"reference/#ibkr_porez.report_base-attributes","title":"Attributes","text":""},{"location":"reference/#ibkr_porez.report_base-classes","title":"Classes","text":""},{"location":"reference/#ibkr_porez.report_base.ReportGeneratorBase","title":"ibkr_porez.report_base.ReportGeneratorBase","text":"<p>               Bases: <code>ABC</code></p> <p>Base class for report generators.</p> Attributes <code></code> ibkr_porez.report_base.ReportGeneratorBase.cfg <code>instance-attribute</code> <pre><code>cfg = load_config()\n</code></pre> <code></code> ibkr_porez.report_base.ReportGeneratorBase.nbs <code>instance-attribute</code> <pre><code>nbs = NBSClient(storage)\n</code></pre> <code></code> ibkr_porez.report_base.ReportGeneratorBase.storage <code>instance-attribute</code> <pre><code>storage = Storage()\n</code></pre> Functions <code></code> ibkr_porez.report_base.ReportGeneratorBase.filename <code>abstractmethod</code> <pre><code>filename(*args: Any, **kwargs: Any) -&gt; str\n</code></pre> <p>Generate filename for the report.</p> <p>Parameters:</p> Name Type Description Default <code>*args</code> <code>Any</code> <p>Positional arguments (type-specific).</p> <code>()</code> <code>**kwargs</code> <code>Any</code> <p>Keyword arguments (type-specific).</p> <code>{}</code> <p>Returns:</p> Type Description <code>str</code> <p>Filename string.</p> <code></code> ibkr_porez.report_base.ReportGeneratorBase.generate <code>abstractmethod</code> <pre><code>generate(start_date: date, end_date: date, force: bool = False) -&gt; Generator[tuple[str, str, list[Any]], None, None]\n</code></pre> <p>Generate report declarations.</p> <p>Parameters:</p> Name Type Description Default <code>start_date</code> <code>date</code> <p>Start date for the report period.</p> required <code>end_date</code> <code>date</code> <p>End date for the report period.</p> required <code>force</code> <code>bool</code> <p>Force generation even if validation fails (for income reports).</p> <code>False</code> <p>Yields:</p> Type Description <code>tuple[str, str, list[Any]]</code> <p>tuple[str, str, list]: (filename, xml_content, entries) tuples.</p>"},{"location":"reference/#ibkr_porez.report_gains","title":"ibkr_porez.report_gains","text":"<p>Generator for PPDG-3R (Capital Gains) reports.</p>"},{"location":"reference/#ibkr_porez.report_gains-classes","title":"Classes","text":""},{"location":"reference/#ibkr_porez.report_gains.GainsReportGenerator","title":"ibkr_porez.report_gains.GainsReportGenerator","text":"<p>               Bases: <code>ReportGeneratorBase</code></p> <p>Generator for PPDG-3R (Capital Gains) reports.</p> Attributes <code></code> ibkr_porez.report_gains.GainsReportGenerator.JUNE_MONTH <code>class-attribute</code> <code>instance-attribute</code> <pre><code>JUNE_MONTH = 6\n</code></pre> <code></code> ibkr_porez.report_gains.GainsReportGenerator.tax_calc <code>instance-attribute</code> <pre><code>tax_calc = TaxCalculator(nbs)\n</code></pre> <code></code> ibkr_porez.report_gains.GainsReportGenerator.xml_gen <code>instance-attribute</code> <pre><code>xml_gen = XMLGenerator(cfg)\n</code></pre> Functions <code></code> ibkr_porez.report_gains.GainsReportGenerator.filename <pre><code>filename(end_date: date) -&gt; str\n</code></pre> <p>Generate filename for gains report.</p> <p>Parameters:</p> Name Type Description Default <code>end_date</code> <code>date</code> <p>End date for the report period.</p> required <p>Returns:</p> Type Description <code>str</code> <p>Filename string in format: ppdg3r-yyyy-Hh.xml</p> <code></code> ibkr_porez.report_gains.GainsReportGenerator.generate <pre><code>generate(start_date: date, end_date: date, force: bool = False)\n</code></pre> <p>Generate PPDG-3R XML report.</p> <p>Parameters:</p> Name Type Description Default <code>start_date</code> <code>date</code> <p>Start date for the report period.</p> required <code>end_date</code> <code>date</code> <p>End date for the report period.</p> required <p>Yields:</p> Type Description <p>tuple[str, str, list[TaxReportEntry]]: (filename, xml_content, entries) tuple. For gains, this will always be a single yield.</p> <p>Raises:</p> Type Description <code>ValueError</code> <p>If no transactions found or no taxable sales in period.</p>"},{"location":"reference/#ibkr_porez.report_income","title":"ibkr_porez.report_income","text":"<p>Generator for PP OPO (Capital Income) reports.</p>"},{"location":"reference/#ibkr_porez.report_income-attributes","title":"Attributes","text":""},{"location":"reference/#ibkr_porez.report_income-classes","title":"Classes","text":""},{"location":"reference/#ibkr_porez.report_income.IncomeReportGenerator","title":"ibkr_porez.report_income.IncomeReportGenerator","text":"<p>               Bases: <code>ReportGeneratorBase</code></p> <p>Generator for PP OPO (Capital Income) reports.</p> Attributes <code></code> ibkr_porez.report_income.IncomeReportGenerator.xml_gen <code>instance-attribute</code> <pre><code>xml_gen = IncomeXMLGenerator(cfg)\n</code></pre> Functions <code></code> ibkr_porez.report_income.IncomeReportGenerator.filename <pre><code>filename(declaration_date: date, symbol: str, currency: Currency, income_type: str) -&gt; str\n</code></pre> <p>Generate filename for income report.</p> <p>Parameters:</p> Name Type Description Default <code>declaration_date</code> <code>date</code> <p>Date of the declaration.</p> required <code>symbol</code> <code>str</code> <p>Symbol for dividends.</p> required <code>currency</code> <code>Currency</code> <p>Currency for interest/coupons.</p> required <code>income_type</code> <code>str</code> <p>Type of income (\"dividend\" or \"coupon\").</p> required <p>Returns:</p> Type Description <code>str</code> <p>Filename string in format: ppopo-{symbol}-{yyyy}-{mmdd}.xml</p> <code></code> ibkr_porez.report_income.IncomeReportGenerator.generate <pre><code>generate(start_date: date, end_date: date, force: bool = False)\n</code></pre> <p>Generate PP OPO XML reports for income in period.</p> <p>Creates separate declarations for each day and income type (dividends and coupons are separate declarations even on same day).</p> <p>Parameters:</p> Name Type Description Default <code>start_date</code> <code>date</code> <p>Start date for the report period.</p> required <code>end_date</code> <code>date</code> <p>End date for the report period.</p> required <code>filename</code> <p>Optional base filename. If not provided, will be generated.</p> required <code>force</code> <code>bool</code> <p>If True, create declaration with zero tax even if withholding tax not found.</p> <code>False</code> <p>Yields:</p> Type Description <p>tuple[str, str, list[IncomeDeclarationEntry]]: (filename, xml_content, entries) tuple. Each entry represents one declaration row with calculated tax fields.</p> <p>Raises:</p> Type Description <code>ValueError</code> <p>If no transactions found, no income in period, or withholding tax not found (unless force=True).</p>"},{"location":"reference/#ibkr_porez.storage","title":"ibkr_porez.storage","text":""},{"location":"reference/#ibkr_porez.storage-attributes","title":"Attributes","text":""},{"location":"reference/#ibkr_porez.storage-classes","title":"Classes","text":""},{"location":"reference/#ibkr_porez.storage.Storage","title":"ibkr_porez.storage.Storage","text":"Attributes ibkr_porez.storage.Storage.APP_NAME <code>class-attribute</code> <code>instance-attribute</code> <pre><code>APP_NAME = 'ibkr-porez'\n</code></pre> <code></code> ibkr_porez.storage.Storage.DATA_SUBDIR <code>class-attribute</code> <code>instance-attribute</code> <pre><code>DATA_SUBDIR = 'ibkr-porez-data'\n</code></pre> <code></code> ibkr_porez.storage.Storage.DECLARATIONS_DIR <code>class-attribute</code> <code>instance-attribute</code> <pre><code>DECLARATIONS_DIR = 'declarations'\n</code></pre> <code></code> ibkr_porez.storage.Storage.DECLARATIONS_FILENAME <code>class-attribute</code> <code>instance-attribute</code> <pre><code>DECLARATIONS_FILENAME = 'declarations.json'\n</code></pre> <code></code> ibkr_porez.storage.Storage.FLEX_QUERIES_DIR <code>class-attribute</code> <code>instance-attribute</code> <pre><code>FLEX_QUERIES_DIR = 'flex-queries'\n</code></pre> <code></code> ibkr_porez.storage.Storage.LAST_DECLARATION_DATE_KEY <code>class-attribute</code> <code>instance-attribute</code> <pre><code>LAST_DECLARATION_DATE_KEY = 'last_declaration_date'\n</code></pre> <code></code> ibkr_porez.storage.Storage.RATES_FILENAME <code>class-attribute</code> <code>instance-attribute</code> <pre><code>RATES_FILENAME = 'rates.json'\n</code></pre> <code></code> ibkr_porez.storage.Storage.TRANSACTIONS_FILENAME <code>class-attribute</code> <code>instance-attribute</code> <pre><code>TRANSACTIONS_FILENAME = 'transactions.json'\n</code></pre> <code></code> ibkr_porez.storage.Storage.data_dir <code>property</code> <pre><code>data_dir: Path\n</code></pre> <p>Get the data directory path (ibkr-porez-data subfolder).</p> <code></code> ibkr_porez.storage.Storage.declarations_dir <code>property</code> <pre><code>declarations_dir: Path\n</code></pre> <p>Get the declarations directory path.</p> <code></code> ibkr_porez.storage.Storage.flex_queries_dir <code>property</code> <pre><code>flex_queries_dir: Path\n</code></pre> <p>Get the flex queries directory path.</p> Functions <code></code> ibkr_porez.storage.Storage.declaration_exists <pre><code>declaration_exists(declaration_id: str) -&gt; bool\n</code></pre> <p>Check if declaration exists.</p> <code></code> ibkr_porez.storage.Storage.get_declaration <pre><code>get_declaration(declaration_id: str) -&gt; Declaration | None\n</code></pre> <p>Get specific declaration by ID.</p> <code></code> ibkr_porez.storage.Storage.get_declarations <pre><code>get_declarations(status: DeclarationStatus | None = None, declaration_type: DeclarationType | None = None) -&gt; list[Declaration]\n</code></pre> <p>Get declarations with optional filtering.</p> <code></code> ibkr_porez.storage.Storage.get_exchange_rate <pre><code>get_exchange_rate(date_obj: date, currency: Currency) -&gt; ExchangeRate | None\n</code></pre> <code></code> ibkr_porez.storage.Storage.get_last_declaration_date <pre><code>get_last_declaration_date() -&gt; date | None\n</code></pre> <p>Get last date for which declarations were created.</p> <code></code> ibkr_porez.storage.Storage.get_last_transaction_date <pre><code>get_last_transaction_date() -&gt; date | None\n</code></pre> <p>Find the date of the latest transaction.</p> <code></code> ibkr_porez.storage.Storage.get_transactions <pre><code>get_transactions(start_date: date | None = None, end_date: date | None = None) -&gt; DataFrame\n</code></pre> <p>Load transactions into a DataFrame.</p> <code></code> ibkr_porez.storage.Storage.save_declaration <pre><code>save_declaration(declaration: Declaration) -&gt; None\n</code></pre> <p>Save or update declaration.</p> <code></code> ibkr_porez.storage.Storage.save_exchange_rate <pre><code>save_exchange_rate(rate: ExchangeRate)\n</code></pre> <code></code> ibkr_porez.storage.Storage.save_raw_report <pre><code>save_raw_report(content: str | bytes, filename: str)\n</code></pre> <code></code> ibkr_porez.storage.Storage.save_transactions <pre><code>save_transactions(transactions: list[Transaction]) -&gt; tuple[int, int]\n</code></pre> <p>Save transactions to storage. Returns:     tuple[int, int]: (count_inserted, count_updated)</p> <code></code> ibkr_porez.storage.Storage.set_last_declaration_date <pre><code>set_last_declaration_date(date_obj: date) -&gt; None\n</code></pre> <p>Set last date for which declarations were created.</p> <code></code> ibkr_porez.storage.Storage.update_declaration_status <pre><code>update_declaration_status(declaration_id: str, status: DeclarationStatus, timestamp: datetime) -&gt; None\n</code></pre> <p>Update declaration status and timestamp.</p>"},{"location":"reference/#ibkr_porez.storage_flex_queries","title":"ibkr_porez.storage_flex_queries","text":"<p>Storage and restoration of flex query XML reports using delta compression.</p>"},{"location":"reference/#ibkr_porez.storage_flex_queries-attributes","title":"Attributes","text":""},{"location":"reference/#ibkr_porez.storage_flex_queries.SMALL_FILE_THRESHOLD_BYTES","title":"ibkr_porez.storage_flex_queries.SMALL_FILE_THRESHOLD_BYTES  <code>module-attribute</code>","text":"<pre><code>SMALL_FILE_THRESHOLD_BYTES = 2048\n</code></pre>"},{"location":"reference/#ibkr_porez.storage_flex_queries-classes","title":"Classes","text":""},{"location":"reference/#ibkr_porez.storage_flex_queries-functions","title":"Functions","text":""},{"location":"reference/#ibkr_porez.storage_flex_queries.restore_report","title":"ibkr_porez.storage_flex_queries.restore_report","text":"<pre><code>restore_report(storage: Storage, report_date: date) -&gt; str | None\n</code></pre> <p>Restore full XML report for a specific date.</p> <p>Applies deltas sequentially to base file to reconstruct the full XML.</p> <p>Parameters:</p> Name Type Description Default <code>storage</code> <code>Storage</code> <p>Storage instance</p> required <code>report_date</code> <code>date</code> <p>Date of the report to restore</p> required <p>Returns:</p> Type Description <code>str | None</code> <p>Full XML content as string, or None if report not found</p>"},{"location":"reference/#ibkr_porez.storage_flex_queries.save_raw_report_with_delta","title":"ibkr_porez.storage_flex_queries.save_raw_report_with_delta","text":"<pre><code>save_raw_report_with_delta(storage: Storage, xml_content: str, report_date: date) -&gt; None\n</code></pre> <p>Save raw XML report using delta compression.</p> <p>Only one report per day is kept (latest replaces previous). Reports for different days use delta compression to save space.</p> <p>Parameters:</p> Name Type Description Default <code>storage</code> <code>Storage</code> <p>Storage instance</p> required <code>xml_content</code> <code>str</code> <p>Full XML content from IBKR</p> required <code>report_date</code> <code>date</code> <p>Date of the report</p> required"},{"location":"reference/#ibkr_porez.tax","title":"ibkr_porez.tax","text":""},{"location":"reference/#ibkr_porez.tax-classes","title":"Classes","text":""},{"location":"reference/#ibkr_porez.tax.TaxCalculator","title":"ibkr_porez.tax.TaxCalculator","text":"Attributes ibkr_porez.tax.TaxCalculator.nbs <code>instance-attribute</code> <pre><code>nbs = nbs_client\n</code></pre> Functions <code></code> ibkr_porez.tax.TaxCalculator.process_trades <pre><code>process_trades(df: DataFrame) -&gt; list[TaxReportEntry]\n</code></pre> <p>Process trades using FIFO matching to calculate capital gains.</p> <p>Parameters:</p> Name Type Description Default <code>df</code> <code>DataFrame</code> <p>DataFrame containing all transactions.</p> required <p>Returns:</p> Type Description <code>list[TaxReportEntry]</code> <p>List of TaxReportEntry.</p>"},{"location":"reference/#ibkr_porez.validation","title":"ibkr_porez.validation","text":"<p>Validation error handling utilities.</p>"},{"location":"reference/#ibkr_porez.validation-functions","title":"Functions","text":""},{"location":"reference/#ibkr_porez.validation.format_validation_error","title":"ibkr_porez.validation.format_validation_error","text":"<pre><code>format_validation_error(error: ValidationError) -&gt; str\n</code></pre> <p>Format Pydantic ValidationError into a clean, user-friendly message.</p> <p>Extracts error messages from ValidationError and combines multiple errors.</p> <p>Parameters:</p> Name Type Description Default <code>error</code> <code>ValidationError</code> <p>Pydantic ValidationError instance.</p> required <p>Returns:</p> Name Type Description <code>str</code> <code>str</code> <p>Clean error message.</p>"},{"location":"reference/#ibkr_porez.validation.handle_validation_error","title":"ibkr_porez.validation.handle_validation_error","text":"<pre><code>handle_validation_error(error: ValidationError, console_instance) -&gt; None\n</code></pre> <p>Handle ValidationError by printing a clean error message to console.</p> <p>Parameters:</p> Name Type Description Default <code>error</code> <code>ValidationError</code> <p>Pydantic ValidationError instance.</p> required <code>console_instance</code> <p>Rich Console instance to print the error.</p> required"},{"location":"usage/","title":"Usage","text":""},{"location":"usage/#configuration-config","title":"Configuration (config)","text":"<pre><code>ibkr-porez config\n</code></pre> <p>Creating or modifying personal data and IBKR access settings.</p> <p>You will be prompted for:</p> <ul> <li>IBKR Flex Token: Get Token \u2197</li> <li>IBKR Query ID: Create Flex Query \u2197</li> <li>Personal ID: JMBG / EBS</li> <li>Full Name: First and Last Name</li> <li>Address: Registered Address</li> <li>City Code: 3-digit municipality code. Example: <code>223</code> (Novi Sad). Code can be found in the list (see column \"\u0160ifra\"). Also available in the dropdown on the ePorezi portal.</li> <li>Phone: Phone</li> <li>Email: Email</li> <li>Data Directory: Absolute path to folder with data files (<code>transactions.json</code>, <code>declarations.json</code>, <code>rates.json</code>, etc.). Default: <code>ibkr-porez-data</code> in the application folder.</li> <li>Output Folder: Absolute path to folder for saving files from <code>sync</code>, <code>export</code>, <code>export-flex</code>, <code>report</code> commands. Default: your system's Downloads folder.</li> </ul>"},{"location":"usage/#fetch-data-fetch","title":"Fetch Data (<code>fetch</code>)","text":"<pre><code>ibkr-porez fetch\n</code></pre> <p>Downloads latest data from IBKR and syncs exchange rates from NBS (National Bank of Serbia).</p> <p>Saves them to local storage.</p>"},{"location":"usage/#import-historical-data-import","title":"Import Historical Data (<code>import</code>)","text":"<pre><code>ibkr-porez import /path/to/activity_statement.csv\n</code></pre> <p>Loading transaction history older than 365 days, which cannot be retrieved via Flex Query (<code>fetch</code>).</p> <p>To create a file with transactions on the Interactive Brokers portal, see Export Full History \u2197</p> <p>\u26a0\ufe0f Do not forget to run <code>fetch</code> after <code>import</code> so the application adds maximum details at least for the last year into the less detailed data loaded from CSV.</p>"},{"location":"usage/#synchronization-logic-import-fetch","title":"Synchronization Logic (<code>import</code> + <code>fetch</code>)","text":"<p>When loading data from CSV (<code>import</code>) and Flex Query (<code>fetch</code>), the system prioritizes more complete Flex Query data:</p> <ul> <li>Flex Query (<code>fetch</code>) data is the source of truth. It overwrites CSV data for any matching dates.</li> <li>If a Flex Query record matches a CSV record semantically (Date, Ticker, Price, Quantity), it counts as an update (replacing with official ID).</li> <li>If data structure differs (e.g. split orders in Flex Query vs \"bundled\" record in CSV), the old CSV record is removed, and new Flex Query records are added.</li> <li>Completely identical records are skipped.</li> </ul>"},{"location":"usage/#sync-data-and-create-declarations-sync","title":"Sync Data and Create Declarations (<code>sync</code>)","text":"<pre><code>ibkr-porez sync\n</code></pre> <p>Does the same as fetch:</p> <ul> <li>Downloads latest transactions from IBKR via Flex Query</li> <li>Syncs exchange rates from NBS</li> </ul> <p>Then creates all necessary declarations for the last 45 days (if they haven't been created already).</p> <p>You can then Manage created declarations.</p> <p>\ud83d\udca1 If you ran <code>sync</code> for the first time and it created declarations that you already submitted before starting to use the application, you can quickly mark them all as paid and remove them from list output: <pre><code>ibkr-porez list --status submitted -1 | xargs -I {} ibkr-porez pay {}\n</code></pre></p>"},{"location":"usage/#view-statistics-stat","title":"View Statistics (<code>stat</code>)","text":"<pre><code>ibkr-porez stat --year 2025\nibkr-porez stat --ticker AAPL\nibkr-porez stat --month 2025-01\n</code></pre> <p>Shows:</p> <ul> <li>Dividends received (in RSD)</li> <li>Number of sales (taxable events)</li> <li>Estimated Realized P/L (Capital Gains) (in RSD)</li> <li>Detailed breakdown by tickers or months (when using filters)</li> </ul>"},{"location":"usage/#generate-tax-report-report","title":"Generate Tax Report (<code>report</code>)","text":"<pre><code>ibkr-porez report\n</code></pre> <p>If you don't specify report type and period, PPDG-3R for the last complete half-year is generated by default</p> <ul> <li>Creates <code>ppdg3r_XXXX_HY.xml</code> in Output Folder</li> <li>Import this file into the Serbian Tax Administration portal (ePorezi)</li> <li>Manually upload the file from Confirmation Document to Item 8</li> </ul> <p>To select a different declaration type or time period, see the documentation</p> <pre><code>ibkr-porez report --help\n</code></pre>"},{"location":"usage/#declaration-management","title":"Declaration Management","text":"<p>After creating declarations through the sync command, you can view them, change their status, and export them for upload to the tax portal.</p>"},{"location":"usage/#list-declarations-list","title":"List Declarations (<code>list</code>)","text":"<p>Shows a list of all declarations with the ability to filter by status.</p> <pre><code># Show active declarations (default):\n# draft + submitted + pending\nibkr-porez list\n\n# Show all declarations\nibkr-porez list --all\n\n# Filter by status\nibkr-porez list --status draft\nibkr-porez list --status submitted\nibkr-porez list --status pending\nibkr-porez list --status finalized\n\n# Only declaration IDs (for use in pipes)\nibkr-porez list --ids-only\nibkr-porez list --status draft -1\n</code></pre> <p>Example usage in Linux-style: <pre><code># Submit all drafts\nibkr-porez list --status draft -1 | xargs -I {} ibkr-porez submit {}\n</code></pre></p>"},{"location":"usage/#view-declaration-details-show","title":"View Declaration Details (<code>show</code>)","text":"<p>Shows detailed information about a specific declaration.</p> <pre><code>ibkr-porez show &lt;declaration_id&gt;\n</code></pre> <p>Displays:</p> <ul> <li>Declaration type (PPDG-3R or PP OPO)</li> <li>Declaration period</li> <li>Status (draft, submitted, pending, finalized)</li> <li>Transaction details and calculations</li> <li>Attached files</li> </ul>"},{"location":"usage/#submit-declaration-submit","title":"Submit Declaration (<code>submit</code>)","text":"<pre><code>ibkr-porez submit &lt;declaration_id&gt;\n</code></pre> <p>Marks the declaration as submitted (imported to the tax portal).</p> <p>Behavior depends on declaration type:</p> <ul> <li><code>PPDG-3R</code> moves to <code>pending</code> after <code>submit</code> (waiting for tax authority assessment).</li> <li><code>PP OPO</code> after <code>submit</code>:<ul> <li>moves to <code>submitted</code> if tax is due;</li> <li>moves directly to <code>finalized</code> if tax due is <code>0</code>.</li> </ul> </li> </ul>"},{"location":"usage/#pay-declaration-pay","title":"Pay Declaration (<code>pay</code>)","text":"<pre><code>ibkr-porez pay &lt;declaration_id&gt;\nibkr-porez pay &lt;declaration_id&gt; --tax 1234.56\n</code></pre> <p>Marks the declaration as finalized and stores payment date.</p> <p>Option <code>--tax</code> lets you record tax amount during payment, without a separate <code>assess</code> step.</p> <p>After this, it will disappear from the list shown by list (without <code>--all</code>)</p>"},{"location":"usage/#record-assessed-tax-assess","title":"Record Assessed Tax (<code>assess</code>)","text":"<pre><code># Record official tax amount from the tax authority\nibkr-porez assess &lt;declaration_id&gt; --tax-due 1234.56\n\n# Record amount and immediately mark as already paid\nibkr-porez assess &lt;declaration_id&gt; --tax-due 1234.56 --paid\n</code></pre> <p>This command is mainly for <code>PPDG-3R</code>, where tax amount is determined by the tax authority after submission.</p> <p>What it does:</p> <ul> <li>stores official tax amount in declaration metadata;</li> <li>with <code>--paid</code>, immediately moves declaration to <code>finalized</code>;</li> <li>without <code>--paid</code>:<ul> <li>if amount is greater than zero, keeps declaration active (<code>submitted</code>) for later payment;</li> <li>if amount is zero, moves declaration to <code>finalized</code>.</li> </ul> </li> </ul>"},{"location":"usage/#export-declaration-export","title":"Export Declaration (<code>export</code>)","text":"<pre><code>ibkr-porez export &lt;declaration_id&gt;\nibkr-porez export &lt;declaration_id&gt; -o /path/to/output\n</code></pre> <p>Copies XML and all attached files (attach) to Output Folder or to the directory specified in parameters.</p>"},{"location":"usage/#revert-declaration-status-revert","title":"Revert Declaration Status (<code>revert</code>)","text":"<pre><code># Revert to draft (default)\nibkr-porez revert &lt;declaration_id&gt;\n\n# Revert to submitted\nibkr-porez revert &lt;declaration_id&gt; --to submitted\n</code></pre> <p>Reverts declaration status.</p>"},{"location":"usage/#attach-file-to-declaration-attach","title":"Attach File to Declaration (<code>attach</code>)","text":"<pre><code># Attach file\nibkr-porez attach &lt;declaration_id&gt; /path/to/file.pdf\n\n# Delete attached file\nibkr-porez attach &lt;declaration_id&gt; &lt;file_id&gt; --delete\nibkr-porez attach &lt;declaration_id&gt; --delete --file-id &lt;file_id&gt;\n</code></pre> <p>Attaches a file to a declaration or removes an attached file from declaration storage.</p> <p>For saving to declaration storage, only the file name is used (path is discarded), so names must be unique - otherwise a file with the same name will overwrite a previously uploaded file with the same name even if from a different path</p> <p>\ud83d\udca1 Attached files are copied along with the declaration XML during export</p>"},{"location":"usage/#export-flex-query-export-flex","title":"Export Flex Query (<code>export-flex</code>)","text":"<pre><code>ibkr-porez export-flex 2025-01-15\nibkr-porez export-flex 2025-01-15 -o /path/to/output.xml\nibkr-porez export-flex 2025-01-15 -o -  # Output to stdout (for pipes)\n</code></pre> <p>Exports Flex Query XML file obtained during fetch or sync on the specified date.</p> <p>Example usage in Linux-style: <pre><code>ibkr-porez export-flex 2025-01-15 | ibkr-porez import\n</code></pre></p>"}]}