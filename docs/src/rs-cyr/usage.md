# Упутство за употребу

## Конфигурација

Пре прве употребе, покрените config команду да сачувате ваше IBKR креденцијале и личне податке.

```bash
ibkr-porez config
```

Биће вам затражено:

*   **IBKR Flex Token**: (Из IBKR подешавања)
*   **IBKR Query ID**: (Из вашег сачуваног Flex Query-а)
*   **Personal ID**: (ЈМБГ за пореске обрасце)
*   **Full Name**: (Пуно име за пореске обрасце)
*   **Address**: (Адреса за пореске обрасце)
*   **City Code**: Троцифрени код општине (Шифра општине). Пример: `223` (Нови Сад). Код можете наћи у [шифарнику](https://www.apml.gov.rs/uploads/useruploads/Documents/1533_1_pravilnik-javni_prihodi_prilog-3.pdf) (видети колону "Шифра"). Код је такође доступан у падајућем менију на порталу еПорези.
*   **Phone**: (Контакт телефон)
*   **Email**: (Контакт email)

## Преузимање података (`get`)

Преузима најновије податке са IBKR и синхронизује курсеве са НБС (Народна банка Србије).

```bash
ibkr-porez get

# Присилно пуно ажурирање (игнорише локалну историју и преузима последњих 365 дана)
ibkr-porez get --force
```

*   Преузима XML извештај користећи ваш Token/Query ID.
*   Парсира нове трансакције (Сделки, Дивиденде).
*   Чува их у локално складиште.
*   Преузима историјске курсеве за све датуме трансакција.
*   **Подразумевано**: Инкрементално преузима само нове податке (од ваше последње трансакције).
*   **--force**: користите ово ако желите да освежите старије податке.

## Увоз историјских података (`import`)

Користите ову команду за учитавање историје трансакција старије од 365 дана (која се не може преузети путем Flex Query-а).

1.  Преузмите **Custom Statement** са IBKR (Activity Statement -> Custom -> Format: CSV) који покрива недостајући период.
2.  Увезите га:

```bash
ibkr-porez import /path/to/activity_statement.csv
```

### Логика синхронизације података (`import` + `get`)
Када комбинујете CSV податке (Import) и XML податке (Get), систем аутоматски решава преклапања:
*   **Приоритет XML-а**: Званични XML подаци из `get` су извор истине. Они увек замењују CSV податке за било које подударне датуме.
*   **Updated**: Ако се XML запис семантички поклапа са CSV записом (исти Датум, Симбол, Цена, Количина), то се рачуна као **Ажурирање** (надоградња на званични ID).
*   **New**: Ако се структура XML-а разликује (нпр. Split Orders у XML-у против "спојеног" CSV записа), стари CSV запис се замењује новим XML записима. Ово се приказује као **Ново (New)**.
*   **Identical**: Ако су записи идентични, прескачу се.

## Приказ статистике (`show`)

Приказује сажетак активности вашег портфолиа груписан по месецима.

```bash
ibkr-porez show
```

Приказује:
*   Примљене дивиденде (у РСД).
*   Број продаја (порески догађаји).
*   Процену реализованог P/L (Капитална добит) (у РСД).

## Генерисање пореског извештаја ППДГ-3Р (`report`)

```bash
# Последње пуно полугодиште
ibkr-porez report

# Извештај за друго полугодиште 2024 (1. јул - 31. дец)
ibkr-porez report --year 2024 --half 2
```

*   **Резултат**: `ppdg3r_2024_H1.xml`
*   Увезите овај фајл на портал Пореске управе Србије (еПорези).
